!function(){function e(e,t){e.when("/login",{templateUrl:"login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/login"}),t.html5Mode(!0)}function t(e,t,n,o){e.defaults.headers.common.Authorization="Bearer "+o.getToken(),o.isLoggedIn()&&("patient"==o.currentUserRole()&&(window.location="/patient"),"doctor"==o.currentUserRole()&&(window.location="/doctor"))}angular.module("mainApp",["ngRoute"]),angular.module("mainApp").config(["$routeProvider","$locationProvider",e]).run(["$http","$rootScope","$location","authentication",t])}(),function(){function e(e,t){var n=this;n.isRegister=!1,n.loginCredentials={email:"",password:""},n.registerCredentials={name:"",email:"",password:"",role:""},n.loginSubmit=function(){t.login(n.loginCredentials).error(function(e){alert(e.message)}).then(function(){"patient"==t.currentUserRole()&&(window.location="patient"),"doctor"==t.currentUserRole()&&(window.location="doctor")})},n.registerSubmit=function(){console.log("Submitting registration"),t.register(n.registerCredentials).error(function(e){alert(e.message)}).then(function(){"patient"==t.currentUserRole()&&(window.location="patient"),"doctor"==t.currentUserRole()&&(window.location="doctor")})},n.toggleRegister=function(){n.isRegister===!0?n.isRegister=!1:n.isRegister=!0}}angular.module("mainApp").controller("loginCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(e,t){var n=function(e){t.localStorage["auth-token"]=e},o=function(){return t.localStorage["auth-token"]},r=function(){var e,n=o();return!!n&&(e=n.split(".")[1],e=t.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3)},i=function(){if(r()){var e=o(),n=e.split(".")[1];return n=t.atob(n),n=JSON.parse(n),{_id:n._id,email:n.email,name:n.name,role:n.role}}return!1},a=function(){return i().role},s=function(t){return e.post("/api/register",t).success(function(e){n(e.token)})},u=function(t){return e.post("/api/register-patient",t)},c=function(t){return e.post("/api/login",t).success(function(e){n(e.token)}).error(function(e){console.log(e)})},g=function(){t.localStorage.removeItem("auth-token"),t.location.reload()};return{currentUser:i,currentUserRole:a,saveToken:n,getToken:o,isLoggedIn:r,register:s,registerPatient:u,login:c,logout:g}}angular.module("mainApp").factory("authentication",e),e.$inject=["$http","$window"]}(),function(){function e(e,t){var n=function(){return e.get("/api/profile")},o=function(){return console.log("getPatients Service"),e.get("/api/get-patients")},r=function(){return e.get("/api/get-doctor")},i=function(t){return e.post("/api/doctor-post-message",t)},a=function(t){return e.post("/api/patient-post-message",t)},s=function(t){return e.post("/api/toggle-message",{message:t})},u=function(){return e.get("/api/num-unread-messages")},c=function(){return console.log("getting messages"),e.get("/api/get-messages")},g=function(t){return e.post("/api/post-reply",t)},l=function(t){return e.get("/api/get-replys/"+t)},p=function(){return e.get("/api/get-exercises")},d=function(t){return console.log("Sending to server:"),console.log(t),e.post("/api/get-single-exercise",{exercise:t})},f=function(t){return e.post("/api/post-exercise",t)},m=function(){return e.get("/api/get-event")},v=function(){return e.get("/api/get-patientevent")},h=function(t){return e.post("/api/post-event",t)},w=function(){return e.get("/api/get-gamedata")},R=function(){return console.log("getting"),e.post("/api/generate-gamedata")},S=function(t){return e.post("/api/query-gamedata-single",{date:t})},$=function(t,n,o,r){return e.post("/api/query-gamedata-range",{startDate:t,endDate:n,patient:o,exercise:r})},U=function(t,n){return e.post("/api/query-gamedata-month",{startDate:t,endDate:n})},y=function(t){return e.post("/api/post-gamedata",{date:t.date,time:t.time,code:t.code,pressure:t.pressure})};return{getProfile:n,getPatients:o,getDoctor:r,doctorPostMessage:i,patientPostMessage:a,toggleMessage:s,numUnreadMessages:u,getMessages:c,postReply:g,getReplys:l,getExercise:p,getSingleExercise:d,postExercise:f,getEvent:m,postEvent:h,getPatientEvents:v,getGameData:w,postGameData:y,querySingleDate:S,queryDateRange:$,queryMonth:U,generateGameData:R}}angular.module("mainApp").service("dataService",e),e.$inject=["$http","authentication"]}(),function(){function e(e,t){var n=this;n.isLoggedIn=t.isLoggedIn(),n.currentUser=t.currentUser(),n.signOut=function(){t.logout()}}angular.module("mainApp").controller("navigationCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("mainApp").directive("navigation",e)}();