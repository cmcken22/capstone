!function(){function t(t,e){t.when("/login",{templateUrl:"login/login.view.html",controller:"loginCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/login"}),e.html5Mode(!0)}function e(t,e,n,o){t.defaults.headers.common.Authorization="Bearer "+o.getToken(),o.isLoggedIn()&&("patient"==o.currentUserRole()&&(window.location="/patient"),"doctor"==o.currentUserRole()&&(window.location="/doctor"))}angular.module("mainApp",["ngRoute"]),angular.module("mainApp").config(["$routeProvider","$locationProvider",t]).run(["$http","$rootScope","$location","authentication",e])}(),function(){function t(t,e){var n=this;n.isRegister=!1,n.loginCredentials={email:"",password:""},n.registerCredentials={name:"",email:"",password:"",role:""},n.loginSubmit=function(){e.login(n.loginCredentials).error(function(t){alert(t.message)}).then(function(){"patient"==e.currentUserRole()&&(window.location="patient"),"doctor"==e.currentUserRole()&&(window.location="doctor")})},n.registerSubmit=function(){console.log("Submitting registration"),e.register(n.registerCredentials).error(function(t){alert(t.message)}).then(function(){"patient"==e.currentUserRole()&&(window.location="patient"),"doctor"==e.currentUserRole()&&(window.location="doctor")})},n.toggleRegister=function(){n.isRegister===!0?n.isRegister=!1:n.isRegister=!0}}angular.module("mainApp").controller("loginCtrl",t),t.$inject=["$location","authentication"]}(),function(){function t(t,e){var n=function(t){e.localStorage["auth-token"]=t},o=function(){return e.localStorage["auth-token"]},i=function(){var t,n=o();return!!n&&(t=n.split(".")[1],t=e.atob(t),t=JSON.parse(t),t.exp>Date.now()/1e3)},r=function(){if(i()){var t=o(),n=t.split(".")[1];return n=e.atob(n),n=JSON.parse(n),{_id:n._id,email:n.email,name:n.name,role:n.role}}return!1},a=function(){return r().role},s=function(e){return t.post("/api/register",e).success(function(t){n(t.token)})},u=function(e){return t.post("/api/register-patient",e)},c=function(e){return t.post("/api/login",e).success(function(t){n(t.token)}).error(function(t){})},g=function(){e.localStorage.removeItem("auth-token"),e.location.reload()};return{currentUser:r,currentUserRole:a,saveToken:n,getToken:o,isLoggedIn:i,register:s,registerPatient:u,login:c,logout:g}}angular.module("mainApp").factory("authentication",t),t.$inject=["$http","$window"]}(),function(){function t(t,e){var n=function(){return t.get("/api/profile")},o=function(){return t.get("/api/get-patients")},i=function(){return t.get("/api/get-doctor")},r=function(e){return t.post("/api/doctor-post-message",e)},a=function(e){return t.post("/api/patient-post-message",e)},s=function(e){return t.post("/api/toggle-message",{message:e})},u=function(){return t.get("/api/num-unread-messages")},c=function(){return console.log("getting messages"),t.get("/api/get-messages")},g=function(e){return t.post("/api/post-reply",e)},l=function(e){return t.get("/api/get-replys/"+e)},p=function(){return t.get("/api/get-exercises")},d=function(e){return console.log("Sending to server:"),t.post("/api/get-single-exercise",{exercise:e})},m=function(e){return t.post("/api/post-exercise",e)},f=function(){return t.get("/api/get-event")},v=function(){return t.get("/api/get-patientevent")},h=function(e){return console.log("dataservice: "+e),t.post("/api/get-eventByPatientId",{_id:e})},w=function(e){return t.post("/api/post-event",e)},R=function(){return t.get("/api/get-gamedata")},y=function(e){return t.post("/api/get-gamedata-by-id",{_id:e})},D=function(e){return t.post("/api/getGameDataForPatient",{patient:e})},$=function(){return console.log("getting"),t.post("/api/generate-gamedata")},S=function(e){return t.post("/api/query-gamedata-single",{date:e})},U=function(e,n,o,i){return t.post("/api/query-gamedata-range",{startDate:e,endDate:n,patient:o,exercise:i})},P=function(e,n){return t.post("/api/query-gamedata-month",{startDate:e,endDate:n})},A=function(e){return t.post("/api/post-gamedata",{date:e.date,time:e.time,code:e.code,pressure:e.pressure})};return{getProfile:n,getPatients:o,getDoctor:i,doctorPostMessage:r,patientPostMessage:a,toggleMessage:s,numUnreadMessages:u,getMessages:c,postReply:g,getReplys:l,getExercise:p,getSingleExercise:d,postExercise:m,getEvents:f,getEventByPatientId:h,postEvent:w,getPatientEvents:v,getGameData:R,getGameDataForPatient:D,getGameDataById:y,postGameData:A,querySingleDate:S,queryDateRange:U,queryMonth:P,generateGameData:$}}angular.module("mainApp").service("dataService",t),t.$inject=["$http","authentication"]}(),function(){function t(t,e){var n=this;n.isLoggedIn=e.isLoggedIn(),n.currentUser=e.currentUser(),n.signOut=function(){e.logout()}}angular.module("mainApp").controller("navigationCtrl",t),t.$inject=["$location","authentication"]}(),function(){function t(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("mainApp").directive("navigation",t)}();