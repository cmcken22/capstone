!function(){function e(e,t){"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(function(e){console.log("ServiceWorker registration failed: ",e)})}),e.when("/dashboard",{templateUrl:"doctor/dashboard/dashboard.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/profile",{templateUrl:"doctor/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/patients",{templateUrl:"doctor/patients/patients.view.html",controller:"patientsCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/exercise-manager",{templateUrl:"doctor/event/event.view.html",controller:"eventCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/manager",{templateUrl:"doctor/manager/manager.view.html",controller:"managerCtrl",controllerAs:"vm"}).when("/messages",{templateUrl:"doctor/messages/messages.view.html",controller:"messagesCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/calendar",{templateUrl:"doctor/calendar/calendar.view.html",controller:"calendarCtrl",controllerAs:"vm"}).when("/exercises",{templateUrl:"doctor/exercises/exercises.view.html",controller:"exercisesCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/simulation",{templateUrl:"doctor/sim/sim.view.html",controller:"simCtrl"}).when("/doctor",{redirectTo:"/dashboard"}).otherwise({redirectTo:"/dashboard"}),t.html5Mode(!0)}function t(e,t,a,r){r.defaults.headers.common.Authorization="Bearer "+a.getToken()}angular.module("mainApp",["ngRoute"]),angular.module("mainApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication","$http",t])}(),function(){function e(e,t,a,r){var n=this;n.everythingLoaded=!1,n.events=new Array,n.patient_ids=[],n.patientList=[],n.exerciseList=[],n.populatedApps=[],n.selectedPatient="Appointment",n.populatedEvents=new Array,n.updateCalendar=function(){console.log("updating calendar"),n.populateEvents(),$("#calendar").fullCalendar("removeEvents"),$("#calendar").fullCalendar("addEventSource",n.populatedEvents),$("#calendar").fullCalendar("rerenderEvents")},n.getPatients=function(){a.getPatients().then(function(e){console.log(e),e.data.forEach(function(e){n.patientList.push(e),n.patient_ids.push(e._id)}),console.log(n.patient_ids),n.getExercises(),n.getEvents()})},n.getExercises=function(){a.getExercise().then(function(e){console.log("getExercises"),console.log(e),e.data.forEach(function(e){n.exerciseList.push(e)})})},$("#select").on("change",function(){n.selectedPatient=this.value,console.log(n.selectedPatient),n.updateCalendar()}),n.getEvents=function(){a.getEventByPatientId(n.patient_ids).success(function(e){n.events=e,n.events.forEach(function(e){n.patientList.forEach(function(t){t._id==e.patient&&(e.patient=t)}),n.exerciseList.forEach(function(t){t._id==e.exercise&&(e.exercise=t)})}),n.everythingLoaded=!0,console.log(n.events),n.populateEvents(),n.cal()}).error(function(e){console.log(e)})},a.getPatients().success(function(e){n.patientNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#patient-select").select2({data:n.patientNames,placeholder:"Select a patient"}).on("change",function(e){n.compose.patientId=$("#patient-select").val()})}),n.getPatients(),n.populateEvents=function(){n.populatedEvents=[];for(var e=0,t=n.events.length;e<t;e++){var a={title:"",start:"",allDay:"",patient:"",exercise:"",gameData:"",completed:"",end:"",type:"",url:"",color:"",description:""};a.title=n.events[e].patient.name,null!=n.events[e].exercise&&(a.title=a.title+" - "+n.events[e].exercise.name),a.start=n.events[e].date,a.end=n.events[e].endTime,a.allDay=0,a.patient=n.events[e].patient,a.exercise=n.events[e].exercise,a.gameData=n.events[e].gameData,a.completed=n.events[e].completed,a.type=n.events[e].type,null!=n.events[e].exercise&&(a.description=n.events[e].exercise.name),n.selectedPatient==a.patient._id?("appointment"==a.type||"true"==a.type||1==a.type?(a.backgroundColor="#FFBF10",a.textColor="FFFFFF"):null!=a.type&&"false"!=a.type&&""!=a.type&&0!=a.type||(a.backgroundColor="#FF6c3e",a.textColor="FFFFFF"),1==a.completed&&(a.backgroundColor="#1993DC",a.textColor="FFFFFF"),n.populatedEvents.push(a)):"Appointment"==n.selectedPatient&&("appointment"!=a.type&&"true"!=a.type&&1!=a.type||(a.backgroundColor="#FFBF10",a.textColor="FFFFFF",n.populatedEvents.push(a)))}},n.allExercises=[],n.allPatients=[],n.graphDisplayed=!1,n.zoom=!1,n.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Pressure Values"}}],xAxes:[{scaleLabel:{display:!0,labelString:"Time (Seconds)"},ticks:{autoSkip:!1}}]}},n.modal={title:"",details:""},n.graphData={storedObjects:[],datasets:[],labels:[],type:"line",datasetIndex:0,index:0};var s=Chart.helpers.color;n.colors=[],n.colors[0]={light:s(window.chartColors.red).alpha(.3).rgbString(),dark:window.chartColors.red},n.colors[1]={light:s(window.chartColors.blue).alpha(.3).rgbString(),dark:window.chartColors.blue},n.colors[2]={light:s(window.chartColors.green).alpha(.3).rgbString(),dark:window.chartColors.green},n.colors[3]={light:s(window.chartColors.purple).alpha(.3).rgbString(),dark:window.chartColors.purple},n.colors[4]={light:s(window.chartColors.orange).alpha(.3).rgbString(),dark:window.chartColors.orange},n.cal=function(){$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,basicWeek,basicDay"},timezone:"local",defaultDate:"2017-03-30",navLinks:!0,editable:!0,eventLimit:!0,events:n.populatedEvents,eventClick:function(e){if($("#myModal").modal("show"),n.graph(e),e.url)return 0},eventRender:function(e){e.patient,e.exercise,e.gameData,e.completed,e.type,e.description}})},n.gameObject="",n.graph=function(e){a.getGameDataById(e.gameData).then(function(e){n.gameObject=e.data[0],n.updateMainGraph(e.data[0])})},n.updateMainGraph=function(e){console.log("---------Updating Chart Data---------"),console.log(e);for(var t=n.resetCanvas(),a=0,r=[],s=[],o=[],l=[],i=[],c=0;c<e.pressureAxial.length;c++)c%50==0?(i[c]=a,a++):i[c]="",r[c]=e.pressureAxial[c],s[c]=e.pressureA[c],o[c]=e.pressureB[c],l[c]=e.pressureC[c];var d=0,u=[{label:"Axial",backgroundColor:n.colors[d%n.colors.length].light,borderColor:n.colors[d++%n.colors.length].dark,borderWidth:1,data:r},{label:"A",backgroundColor:n.colors[d%n.colors.length].light,borderColor:n.colors[d++%n.colors.length].dark,borderWidth:1,data:s},{label:"B",backgroundColor:n.colors[d%n.colors.length].light,borderColor:n.colors[d++%n.colors.length].dark,borderWidth:1,data:o},{label:"C",backgroundColor:n.colors[d%n.colors.length].light,borderColor:n.colors[d++%n.colors.length].dark,borderWidth:1,data:l}],p={type:"line",data:{labels:i,datasets:u},options:n.options};new Chart(document.getElementById("my-graph").getContext("2d"),p);t.remove()},n.resetCanvas=function(){var e=$(".chartjs-hidden-iframe");e.remove();var t=$("#my-graph");return t.removeAttr("id"),$("#graph").append('<canvas id="my-graph">'),t}}angular.module("mainApp").controller("calendarCtrl",e),e.$inject=["$location","authentication","dataService","$scope"]}(),function(){function e(e,t,a){var r=this;r.activeReply,r.patientNames,r.currentUser=e.currentUser(),r.unreadCount,r.patients,t.getPatients().success(function(e){r.patients=e,r.patientNames=e.map(function(e){return{id:e._id,text:e.name}})}),t.getMessages().then(function(e){r.messages=e.data,r.parseMessageData()}),r.replyClick=function(e){r.activeReply=e,t.getReplys(e._id).success(function(e){r.activeReply.replysData=e})},r.parseMessageData=function(){var e=0;r.messages.forEach(function(t){t.receiver==r.currentUser._id&&0==t.read&&e++}),r.unreadCount=e},r.getSenderName=function(e){return e==r.currentUser._id?r.currentUser.name:r.patientName(e)},r.patientName=function(e){if(!r.patientNames)return"";var t=$.grep(r.patientNames,function(t){return t.id==e});return t[0]?t[0].text:void 0},r.postReply=function(){var e={body:r.replyBody,message:r.activeReply._id};t.postReply(e).success(function(e){r.replyBody="",r.replyClick(r.activeReply),jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your reply has successfully been sent.</div>')}).error(function(){jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your reply.</div>')})},r.togglePatient=function(e){var t="#"+e+" .toggle-section";jQuery(t).toggleClass("toggled")},r.messageSend=function(e){var a={patientId:e,messageSubject:r.messageSubject,messageBody:r.messageBody};t.doctorPostMessage(a).success(function(e){r.messageSubject="",r.messageBody="",jQuery("#dash-messaging .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your message has successfully been sent.</div>')}).error(function(){jQuery("#dash-messaging .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your message.</div>')})},r.viewData=function(e){var t={patientID:e};a.path("/exercises").search({param:t})}}angular.module("mainApp").controller("homeCtrl",e),e.$inject=["authentication","dataService","$location"]}(),function(){function e(e,t,a){var r=this;r.allExercises=[],r.allPatients=[],r.originalObject=null,r.graphDisplayed=!1,r.zoom=!1,r.showSim=!1,r.mainGraph={labels:{yAxes:"Average Pressure Values",xAxes:"Game Objects"}},r.mainGraph.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:r.mainGraph.labels.yAxes}}],xAxes:[{scaleLabel:{display:!0,labelString:r.mainGraph.labels.xAxes}}]}},r.modalGraph={labels:{yAxes:"Pressure Values",xAxes:"Time (Seconds)"}},r.modalGraph.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:r.modalGraph.labels.yAxes}}],xAxes:[{scaleLabel:{display:!0,labelString:r.modalGraph.labels.xAxes},ticks:{autoSkip:!1}}]}},r.modalGraph_2={},r.modalGraph_2.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:r.modalGraph.labels.yAxes},ticks:{beginAtZero:!0}}],xAxes:[{scaleLabel:{display:!0,labelString:r.modalGraph.labels.xAxes},ticks:{autoSkip:!1}}]}},r.refreshOptions=function(){r.mainGraph.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:r.mainGraph.labels.yAxes}}],xAxes:[{scaleLabel:{display:!0,labelString:r.mainGraph.labels.xAxes}}]}},r.modalGraph.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:r.modalGraph.labels.yAxes}}],xAxes:[{scaleLabel:{display:!0,labelString:r.modalGraph.labels.xAxes},ticks:{autoSkip:!1}}]}}},r.currentDate={date:"",day:"",month:"",year:"",string:""},r.nextDate={date:"",day:"",month:"",year:"",string:""},r.setFormDate=function(){r.currentDate.date=new Date,r.currentDate.date.setHours(0,0,0,0),console.log("CURRENT DATE: "+r.currentDate.date),r.currentDate.day=r.currentDate.date.getUTCDate(),r.currentDate.month=r.currentDate.date.getUTCMonth()+1,r.currentDate.year=r.currentDate.date.getFullYear(),r.currentDate.string=r.currentDate.month+"-"+r.currentDate.day+"-"+r.currentDate.year,console.log("CURRENT DATE STRING: "+r.currentDate.string),r.nextDate.date=new Date,r.nextDate.date.setHours(0,0,0,0),r.nextDate.date.setDate(r.nextDate.date.getDate()+7),console.log("NEXT DATE: "+r.nextDate.date),r.nextDate.day=r.nextDate.date.getUTCDate(),r.nextDate.month=r.nextDate.date.getUTCMonth()+1,r.nextDate.year=r.nextDate.date.getFullYear(),r.nextDate.string=r.nextDate.month+"-"+r.nextDate.day+"-"+r.nextDate.year,console.log("NEXT DATE STRING: "+r.nextDate.string)},r.setFormDate(),r.form={date:"",month:r.currentDate.month+"/"+r.currentDate.year,exercise:null,patient:null,startDate:r.currentDate.string,endDate:r.nextDate.string},void 0!=a.param&&(console.log("PARAMS-------"),console.log(a.param.patientID),r.form.patient=a.param.patientID,document.getElementById("patient-select").innerHTML="<option>"+a.param.patientID+"</option>"),r.modal={title:"",details:""},r.graphData={storedObjects:[],datasets:[],labels:[],type:"line",pressureType:0,index:0};var n=Chart.helpers.color;r.colors=[],r.colors[0]={light:n(window.chartColors.red).alpha(.3).rgbString(),dark:window.chartColors.red},r.colors[1]={light:n(window.chartColors.blue).alpha(.3).rgbString(),dark:window.chartColors.blue},r.colors[2]={light:n(window.chartColors.green).alpha(.3).rgbString(),dark:window.chartColors.green},r.colors[3]={light:n(window.chartColors.purple).alpha(.3).rgbString(),dark:window.chartColors.purple},r.colors[4]={light:n(window.chartColors.orange).alpha(.3).rgbString(),dark:window.chartColors.orange},$("#graphArea").hide(),r.initInputFields=function(){r.patientNames=[],e.getPatients().success(function(e){r.patientNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#patient-select").select2({data:r.patientNames,placeholder:"Select a patient"}),$("#patient-select-range").select2({data:r.patientNames,placeholder:"Select a patient"})}),$("#patient-select").on("change",function(){r.form.patient=$("#patient-select").val()}),$("#patient-select-range").on("change",function(){r.form.patient=$("#patient-select-range").val()}),r.exerciseNames=[],e.getExercise().success(function(e){r.allExercises=e,r.exerciseNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#exercise-select").select2({data:r.exerciseNames,placeholder:"Select an Exercise"}),$("#exercise-select-range").select2({data:r.exerciseNames,placeholder:"Select an Exercise"})}),$("#exercise-select").on("change",function(){r.form.exercise=$("#exercise-select").val()}),$("#exercise-select-range").on("change",function(){r.form.exercise=$("#exercise-select-range").val()})},r.initDatePickers=function(){$("#monthPicker").datepicker({format:"mm/yyyy",viewMode:"months",minViewMode:"months",orientation:"bottom",autoclose:!0}).on("changeDate",function(){r.form.month=$("#_monthPicker").val()}),$("#monthPicker").datepicker("update",r.form.month),$("#_startDate").datepicker("update",r.form.startDate),$("#_endDate").datepicker("update",r.form.endDate),$(".input-daterange").datepicker({format:"mm-dd-yyyy",orientation:"bottom",autoclose:!0}).on("changeDate",function(){r.form.startDate=$("#_startDate").val(),r.form.endDate=$("#_endDate").val()})},r.initInputFields(),r.initDatePickers(),r.viewALLByRange=function(){if(null==r.form.exercise)return alert("Please select an exercise"),0;if(null==r.form.patient)return alert("Please select a patient"),0;console.log("Form: "),console.log(r.form),r.clearObjects();var e=new Date(r.form.startDate),t=new Date(r.form.endDate);r.modal.title=e.toDateString()+" - "+t.toDateString(),$("#graphArea").slideDown(),r.createQuery(e,t)},r.viewALLByMonth=function(){if(null==r.form.exercise)return alert("Please select an exercise"),0;if(null==r.form.patient)return alert("Please select a patient"),0;r.clearObjects(),console.log(r.form.exercise);var e=r.form.month.split("/"),t=e[0]+"-01-"+e[1];t=new Date(t);var a=t.getUTCMonth()+2+"-01-"+e[1];a=new Date(a),a.setDate(a.getDate()-1),r.modal.title=r.setMonthString(t.getUTCMonth()+1),r.createQuery(t,a)},r.createQuery=function(t,a){e.queryDateRange(t,a,r.form.patient,r.form.exercise).success(function(e){console.clear(),console.log(e.length),console.log(e),0!=e.length?($("#graphArea").slideDown(),e=r.sortByDate(e),r.graphData.datasets=r.graphALLavg(e,r.form.exercise.name),r.updateMainGraph()):0==e.length&&alert("Error: no data found.")})},r.graphALLavg=function(e,t){console.log("GRAPHING ALL AVG");for(var a=[],n=[],s=[],o=[],l=[],i=0;i<e.length;i++){var c=0,d=0,u=0,p=0;l[i]=i,r.graphData.storedObjects[i]=e[i];for(var g=0;g<e[i].pressureAxial.length;g++)c+=e[i].pressureAxial[g],d+=e[i].pressureA[g],u+=e[i].pressureB[g],p+=e[i].pressureC[g];a[i]=c/e[i].pressureAxial.length,n[i]=d/e[i].pressureA.length,s[i]=u/e[i].pressureB.length,o[i]=p/e[i].pressureC.length}r.graphData.labels=l;var m=0,h=[{label:"Axial",backgroundColor:r.colors[m%r.colors.length].light,borderColor:r.colors[m++%r.colors.length].dark,borderWidth:1,data:a},{label:"A",backgroundColor:r.colors[m%r.colors.length].light,borderColor:r.colors[m++%r.colors.length].dark,borderWidth:1,data:n},{label:"B",backgroundColor:r.colors[m%r.colors.length].light,borderColor:r.colors[m++%r.colors.length].dark,borderWidth:1,data:s},{label:"C",backgroundColor:r.colors[m%r.colors.length].light,borderColor:r.colors[m++%r.colors.length].dark,borderWidth:1,data:o}];return h},r.clearObjects=function(){r.graphData.storedObjects=[],r.graphData.datasets=[],r.graphData.labels=[],r.datasetIndex=0,r.index=0},r.clearForm=function(){r.form={date:"",month:r.currentDate.month+"/"+r.currentDate.year,exercise:null,patient:null,startDate:r.currentDate.string,endDate:r.nextDate.string},$("#exercise-select").select2("val",null),$("#exercise-select-range").select2("val",null),$("#patient-select").select2("val",null),$("#patient-select-range").select2("val",null)},r.clearGraph=function(){console.clear(),console.log("CLEARING GRAPH"),r.clearObjects(),r.clearForm();var e=r.resetCanvas();e.remove(),$("#graphArea").hide()},r.graphPressure=function(e,t,a){console.log("Graphing Pressure:"),console.log(a);var n=[],s=[],o=0,l="";switch(t){case 0:r.modalGraph.labels.yAxes="Pressure (Axial)",r.refreshOptions(),l=e.pressureAxial;break;case 1:r.modalGraph.labels.yAxes="Pressure (A)",r.refreshOptions(),l=e.pressureA;break;case 2:r.modalGraph.labels.yAxes="Pressure (B)",r.refreshOptions(),l=e.pressureB;break;case 3:r.modalGraph.labels.yAxes="Pressure (C)",r.refreshOptions(),l=e.pressureC}for(var i=0;i<l.length;i++)i%50==0?(s[i]=o,o++):s[i]="",n[i]=l[i];var c={label:a,backgroundColor:r.colors[t%r.colors.length].light,borderColor:r.colors[t%r.colors.length].dark,borderWidth:1,data:n};return r.graphData.labels=s,c},r.updateMainGraph=function(){console.log("-------------------\n Updating Chart Data \n-------------------"),r.graphDisplayed=!0;var e=r.resetCanvas();console.log("vm.graphData.datasets"),console.log(r.graphData.datasets);for(var a=-1,n=[],s=0;s<r.graphData.labels.length;s++)r.graphData.labels[s].length>a&&(n=r.graphData.labels[s]);var o={type:r.graphData.type,data:{labels:r.graphData.labels,datasets:r.graphData.datasets},options:r.mainGraph.options},l=new Chart(document.getElementById("my-graph").getContext("2d"),o);e.remove(),console.log("graph created"),document.getElementById("my-graph").onclick=function(e){var a=l.getElementAtEvent(e),n=a[0];if(void 0!==n){r.zoom=!0,r.graphData.pressureType=n._datasetIndex,r.graphData.index=n._index,console.log("pointIndex: "+r.graphData.index);var s=r.graphData.storedObjects[r.graphData.index];console.log("DATA OBJECT: "),console.log(s);var o=new Date(s.date);o.setHours(0,0,0,0),console.log(o),r.modal.details=o.toDateString(),r.modal.gameObject=s,r.originalObject=s,$("#myModal").modal("show"),r.displayObject(s),t.$apply()}}},r.resetCanvas=function(){var e=$(".chartjs-hidden-iframe");e.remove();var t=$("#my-graph");return t.removeAttr("id"),$("#graph").append('<canvas id="my-graph">'),t};var s=null;r.updateModalGraph=function(){console.clear(),console.log("Updating Modal Graph"),r.graphDisplayed=!0;var e=r.resetModalCanvas();console.log("vm.graphData.datasets"),console.log(r.graphData.datasets),console.log(r.modalGraph);var t={type:r.graphData.type,data:{labels:r.graphData.labels,datasets:r.graphData.datasets},options:r.modalGraph.options};s=new Chart(document.getElementById("my-modalGraph").getContext("2d"),t),e.remove()},r.resetModalCanvas=function(){var e=$("#modalGraph > .chartjs-hidden-iframe");e.remove();var t=$("#my-modalGraph");return t.removeAttr("id"),$("#modalGraph").append('<canvas id="my-modalGraph">'),t},r.displayObject=function(t){console.log("Displaying Object:"),console.log(t),console.log(t.exercise),e.getSingleExercise(t.exercise).success(function(e){r.graphData.datasets=[],r.graphData.datasets[0]=r.graphPressure(t,r.graphData.pressureType,e[0].name),r.modal.exercise=e[0].name,r.updateModalGraph()})},r.next=function(){console.log("Next>>>>>>>>>>>>>>>>>>>>>>>>>>");try{r.graphData.index++,console.log(r.graphData.index);var e=r.graphData.storedObjects[r.graphData.index];r.originalObject=e,console.log(e);var t=new Date(e.date);t.setMinutes(0,0,0,0),console.log(t),r.modal.details=t.toDateString(),r.modal.gameObject=e,r.displayObject(e)}catch(e){console.log("error: "+e),r.graphData.index--}},r.prev=function(){console.log("Prev<<<<<<<<<<<<<<<<<<<<<<<<<<");try{r.graphData.index--,console.log(r.graphData.index);var e=r.graphData.storedObjects[r.graphData.index];r.originalObject=e,console.log(e);var t=new Date(e.date);t.setHours(0,0,0,0),console.log(t),r.modal.details=t.toDateString(),r.modal.gameObject=e,r.displayObject(e)}catch(e){console.log("error: "+e),r.graphData.index++}},r.setMonthString=function(e){var t;return 1==e?t="Janurary":2==e?t="February":3==e?t="March":4==e?t="April":5==e?t="May":6==e?t="June":7==e?t="July":8==e?t="August":9==e?t="September":10==e?t="October":11==e?t="November":12==e&&(t="December"),t},r.changeGraphType=function(e,t){console.log("Type: "+e),r.graphData.type=e,"main"==t?r.updateMainGraph():"modal"==t&&r.updateModalGraph()},r.sortByDate=function(e){for(var t=0;t<e.length-1;t++){for(var a=t,r=t+1;r<e.length;r++)e[r].date<e[a].date&&(a=r);var n=e[t];e[t]=e[a],e[a]=n}return e},r.sortByExercise=function(e){for(var t=0;t<e.length-1;t++){for(var a=t,r=t+1;r<e.length;r++)e[r].code<e[a].code&&(a=r);var n=e[t];e[t]=e[a],e[a]=n}return e}}angular.module("mainApp").controller("exercisesCtrl",e),e.$inject=["dataService","$scope","$routeParams"]}(),function(){function e(e,t,a,r){e.sInfo={patient:null,doctor:a.currentUser()._id,exercise:null,description:"",rOption:"days",skip:1,type:!1,date:"",endTime:"",gameData:null,completed:!1,repeat:!1,dateFinish:"",timeLimit:"",alphaFilter:"",gripThreshold:"",axialThreshold:""},e.date,e.startTime="",e.endTime="",e.endDate="",e.mom="",e.end="",e.allex={},e.patients={},$(".datetime").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.date=$(this).val(),console.log($(this).val())}),$(".endDate").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.endDate=moment($(this).val(),"YYYY-MM-DD"),e.sInfo.dateFinish=e.endDate.toJSON(),console.log("repeating until "+e.endDate)}),$("#starttimepick").timepicker({timeFormat:"H:i",scrollDefault:"06:00"}).on("changeTime",function(){e.startTime=$(this).val()}),$("#endtimepick").timepicker({timeFormat:"H:i"}).on("changeTime",function(){e.endTime=$(this).val()}),$("#exercise-select").select2({placeholder:"Select an exercise"}),$("#exercise-select").on("change",function(){e.sInfo.exercise=$("#exercise-select").val()}),function(){for(var e=1;e<=30;e++)$(".1-100").append($("<option></option>").val(e).html(e))}(),e.getExercise=function(){t.getExercise().success(function(t){e.allex=t})},e.getPatients=function(){t.getPatients().success(function(t){e.patients=t})};var n=this;n.addEvent=function(){e.startTime=e.startTime.split(":"),e.endTime=e.endTime.split(":"),e.mom=moment(e.date,"YYYY-MM-DD"),e.mom.set("hour",e.startTime[0]),e.mom.set("minute",e.startTime[1]),e.end=moment(e.date,"YYYY-MM-DD"),e.end.set("hour",e.endTime[0]),e.end.set("minute",e.endTime[1]),e.sInfo.date=e.mom.toJSON(),e.sInfo.endTime=e.end.toJSON(),t.postEvent(e.sInfo).success(function(e){jQuery("#new-event .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>The event was successfully saved.</div>')}).error(function(e){jQuery("#new-event .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error saving the event.</div>')})},n.exerciseInfo={name:"",description:""},n.addExercise=function(){t.postExercise(n.exerciseInfo).success(function(e){console.log(e)}).success(function(e){n.exerciseInfo.name="",n.exerciseInfo.description="",jQuery("#new-exercise .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your exercise was successfully saved.</div>')}).error(function(e){jQuery("#new-exercise .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error saving the exercise.</div>')})},e.getPatients(),e.getExercise(),$("#patient-select").select2({data:e.patients,placeholder:"Select a patient"}),$("#patient-select").on("change",function(){e.sInfo.patient=$("#patient-select").val()}),void 0!=r.param&&(console.log("PARAMS-------"),console.log(r.param.patientID),e.patient=r.param.patientID,document.getElementById("patient-select").innerHTML="<option>"+r.param.patientID+"</option>",console.log(document.getElementById("patient-select").innerHTML))}angular.module("mainApp").controller("eventCtrl",e),e.$inject=["$scope","dataService","authentication","$routeParams"]}(),function(){function e(e,t,a){var r=this;r.currentUser=a.currentUser(),r.messages,r.receivedCount,r.sentCount,r.unreadCount,r.initUnreadCount,r.everythingLoaded=!1,r.compose={messageSubject:"",messageBody:""},r.patientNames,r.replyBody="",t.getPatients().success(function(e){r.patientNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#patient-select").select2({data:r.patientNames,placeholder:"Select a patient"}).on("change",function(e){r.compose.patientId=$("#patient-select").val()})}),r.getMessages=function(){t.getMessages().success(function(e){console.log(e),r.messages=e,r.messageCount=e.length,r.everythingLoaded=!0,r.parseMessageData()})},r.getPatientName=function(e){if(!r.patientNames)return"";var t=$.grep(r.patientNames,function(t){return t.id==e});return t[0]?t[0].text:void 0},r.activeReply,r.replyClick=function(e){r.activeReply=e,t.getReplys(e._id).success(function(e){r.activeReply.replysData=e})},r.postReply=function(){var e={body:r.replyBody,message:r.activeReply._id};t.postReply(e).success(function(e){r.replyBody="",r.replyClick(r.activeReply),jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your reply has successfully been sent.</div>')}).error(function(){jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your reply.</div>')})},r.replySenderName=function(e){var t=a.currentUser();return e==t._id?t.name:r.getPatientName(e)},r.messageSend=function(){var e={patientId:r.compose.patientId,messageSubject:r.compose.messageSubject,messageBody:r.compose.messageBody};t.doctorPostMessage(e).success(function(e){r.compose.messageSubject="",r.compose.messageBody="",r.sentCount++,jQuery("#compose .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your message has successfully been sent.</div>')}).error(function(){jQuery("#compse .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your message.</div>')})},r.readMessage=function(a){a.read||a.sender==r.currentUser._id||$("#rec-"+a._id+" .panel-heading").hasClass("message-unread")&&($("#rec-"+a._id+" .panel-heading").removeClass("message-unread"),$("#unread-"+a._id+" .panel-heading").removeClass("message-unread"),t.toggleMessage(a._id).success(function(){e.$emit("messageRead"),r.unreadCount--})),a.replys&&a.replys.length>0&&t.getReplys(a._id).success(function(e){a.replysData=e})},r.markUnread=function(a){t.toggleMessage(a._id).success(function(){r.unreadCount++,e.$emit("messageUnread"),a.read=!1,$("#rec-"+a._id+" .panel-heading").addClass("message-unread"),$("#unread-"+a._id+" .panel-heading").addClass("message-unread")})},r.isMessageRead=function(e){return e?"message-read":"message-unread"},r.parseMessageData=function(){var e=0,t=0,a=0;r.messages.forEach(function(n){n.sender==r.currentUser._id&&a++,n.receiver==r.currentUser._id&&(t++,0==n.read&&e++)}),r.sentCount=a,r.receivedCount=t,r.unreadCount=e,r.initUnreadCount=e},r.dateString=function(e){var e=new Date(e);return e.toDateString()+", "+e.toLocaleTimeString()},r.getMessages()}angular.module("mainApp").controller("messagesCtrl",e),e.$inject=["$scope","dataService","authentication"]}(),function(){function e(e,t,a,r,n){var s=this;s.patients,s.getPatients=function(){t.getPatients().success(function(e){s.patients=e}).error(function(e){console.log(e)})},s.getPatients(),s.registerCredentials={name:"",email:"",password:"",regDoctor:a.currentUser()._id},s.registerSubmit=function(){a.registerPatient(s.registerCredentials).success(function(e){s.registerCredentials.name="",s.registerCredentials.email="",s.registerCredentials.password="",jQuery("#add .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Patient account has successfully been created.</div>')}).error(function(e){jQuery("#add .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>User email already in use.</div>')})},s.pastMessages=[],s.getPastMessages=function(e){},s.viewData=function(t){console.log("PatientID: "),console.log(t);var a={patientID:t};e.path("/exercises").search({param:a})},s.manageExercises=function(t){console.log("PatientID: "),console.log(t);var a={patientID:t};e.path("/exercise-manager").search({param:a})},s.messageSend=function(e){var a={patientId:e,messageSubject:s.messageSubject,messageBody:s.messageBody};t.doctorPostMessage(a).success(function(e){s.messageSubject="",s.messageBody="",jQuery("#view .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your message has successfully been sent.</div>')}).error(function(){jQuery("#view .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your message.</div>')})},s.togglePatient=function(e){var t="#"+e+" .toggle-section";jQuery(t).toggleClass("toggled")}}angular.module("mainApp").controller("patientsCtrl",e),e.$inject=["$location","dataService","authentication","$scope","$routeParams"]}(),function(){function e(e,t,a,r){var n=this;e.gameDatas="",e.sDate="",e.eDate="",e.selected="",e.GD="",e.allex,e.allPatients,e.exercise,e.patient,e.context;var s;$(".edate").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.eDate=moment($(this).val(),"YYYY-MM-DD"),e.eDate=e.eDate.toJSON()}),$(".sdate").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.sDate=moment($(this).val(),"YYYY-MM-DD"),e.sDate=e.sDate.toJSON()}),e.getData=function(){a.getPatients().success(function(t){e.allPatients=t}),a.getExercise().success(function(t){e.allex=t})},e.getGameData=function(){a.queryDateRange(e.sDate,e.eDate,e.patient,e.exercise).success(function(t){console.log(t),e.gameDatas=t})},e.setGD=function(){a.getGameDataById(e.selected).success(function(t){e.GD=t,e.showData(e.GD[0])})};var o=Chart.helpers.color;n.colors=[],n.colors[0]={light:o(window.chartColors.red).alpha(.3).rgbString(),dark:window.chartColors.red},n.colors[1]={light:o(window.chartColors.blue).alpha(.3).rgbString(),dark:window.chartColors.blue},n.colors[2]={light:o(window.chartColors.green).alpha(.3).rgbString(),dark:window.chartColors.green},n.colors[3]={light:o(window.chartColors.purple).alpha(.3).rgbString(),dark:window.chartColors.purple},n.colors[4]={light:o(window.chartColors.orange).alpha(.3).rgbString(),dark:window.chartColors.orange};var l={labels:[],pressureAxial:[],pressureA:[],pressureB:[],pressureC:[]},i=0,c=function(){console.log("Create Modal Graph");for(var e=0;e<l.pressureAxial.length;e++)e%50==0?l.labels[e]=i++:l.labels[e]="";
({type:"line",data:{labels:l.labels,datasets:[{backgroundColor:n.colors[0%n.colors.length].light,borderColor:n.colors[0%n.colors.length].dark,borderWidth:1,data:[]}]},options:{scales:{yAxes:[{scaleLabel:{display:!0,labelString:"yAxes"},ticks:{beginAtZero:!0}}],xAxes:[{scaleLabel:{display:!0,labelString:"xAxes"},ticks:{autoSkip:!1}}]}}})};e.showData=function(a){l.pressureAxial=a.pressureAxial,console.log(l.pressureAxial),c();var r=e.context;r.fillStyle="#FFFFFF",r.fillRect(50,50,650,400),console.log("Showing Game Data"),console.log(r),console.log(a);var n=a.pressureAxial.length,o=0,i=a.pressureA[0]/7,d=a.pressureB[0]/7,u=a.pressureC[0]/7;s=t(function(){var e=120-a.pressureAxial[o]/8.3;if(r.fillStyle="#7cc9f4",r.beginPath(),r.arc(800,50,23,Math.PI,1.5*Math.PI,!1),r.arc(950,50,23,1.5*Math.PI,0,!1),r.arc(950,450,23,0,.5*Math.PI,!1),r.arc(800,450,23,.5*Math.PI,Math.PI,!1),r.closePath(),r.fill(),r.fillStyle="hsl("+e+",75%,50%)",r.strokeStyle="hsl("+e+",75%,50%)",r.lineWidth=3,o>0){var t=Math.abs(a.canvasX[o]-a.canvasX[o+1]),n=Math.abs(a.canvasY[o]-a.canvasY[o+1]);console.log(t+" vs "+n),r.lineWidth=3,(t<50&&t>1||n<50&&n>1)&&(r.beginPath(),r.moveTo(a.canvasX[o]/3.41+50,400-a.canvasY[o]/2.92+50),r.lineTo(a.canvasX[o+1]/3.41+50,400-a.canvasY[o+1]/2.92+50),r.stroke())}o>0&&(i=.9*i+.1*a.pressureA[o+1]/7,d=.9*d+.1*a.pressureB[o+1]/7,u=.9*u+.1*a.pressureC[o+1]/7),r.beginPath(),r.arc(875,125,i,0,2*Math.PI,!1),r.fillStyle="#5642f4",r.fill(),r.closePath(),r.beginPath(),r.arc(875,250,d,0,2*Math.PI,!1),r.fillStyle="#ae3de2",r.fill(),r.closePath(),r.beginPath(),r.arc(875,375,u,0,2*Math.PI,!1),r.fillStyle="#dd1ab6",r.fill(),r.closePath(),r.font="30px Arial",r.fillStyle="#FFFFFF",r.textAlign="center",r.fillText("Thumb",875,100),r.fillText("Index",875,200),r.fillText("Middle",875,325),o++},20,n)},e.initFromModal=function(t){console.log("INIT FROM MODAL"),e.showData(t)},e.initCanvas=function(){var t=document.getElementById("simulation"),a=t.getContext("2d");a.strokeStyle="#2FA4E7",a.fillStyle="#7cc9f4",a.lineWidth=3,a.fillStyle="#FFFFFF",a.fillRect(50,50,650,400),a.beginPath(),a.arc(25,25,23,Math.PI,1.5*Math.PI,!1),a.arc(975,25,23,1.5*Math.PI,0,!1),a.arc(975,475,23,0,.5*Math.PI,!1),a.arc(25,475,23,.5*Math.PI,Math.PI,!1),a.closePath(),a.stroke(),a.beginPath(),a.arc(800,50,23,Math.PI,1.5*Math.PI,!1),a.arc(950,50,23,1.5*Math.PI,0,!1),a.arc(950,450,23,0,.5*Math.PI,!1),a.arc(800,450,23,.5*Math.PI,Math.PI,!1),a.closePath(),a.fill(),a.stroke(),a.font="30px Arial",a.fillStyle="#2FA4E7",a.textAlign="center",a.fillText("Click to start",400,250),e.context=a}}angular.module("mainApp").controller("simCtrl",e),e.$inject=["$scope","$interval","dataService","authentication"]}(),function(){function e(e,t,a,r,n){var s=this;s.signOut=function(){r.logout()},s.loaded=!1,s.numNewMessages,s.getNumUnread=function(){n.numUnreadMessages().success(function(e){s.numNewMessages=e.count,s.loaded=!0,s.numNewMessages>0&&$("#sidebar-messages").addClass("show-circle")})},e.$on("messageRead",function(){s.numNewMessages--,s.numNewMessages<=0&&(s.numNewMessages=0,$("#sidebar-messages").removeClass("show-circle"))}),e.$on("messageUnread",function(){s.numNewMessages++,$("#sidebar-messages").hasClass("show-circle")||$("#sidebar-messages").addClass("show-circle")}),s.sidebarInit=function(e){$("#menu-toggle").click(function(e){e.preventDefault(),$("#main-wrapper").toggleClass("toggled")}),$("sidebar ul.sidebar-nav li").each(function(){$(this).find("a").attr("href").match(e)?$(this).addClass("active"):$(this).removeClass("active")})},s.getNumUnread(),s.sidebarInit(a.path())}angular.module("mainApp").controller("sidebarCtrl",e),e.$inject=["$scope","$rootScope","$location","authentication","dataService"]}(),function(){function e(){return{templateUrl:"doctor/common/directives/sidebar/sidebar.template.html",controller:"sidebarCtrl as sidevm"}}angular.module("mainApp").directive("sidebar",e)}(),function(){function e(e,t){var a=function(e){t.localStorage["auth-token"]=e},r=function(){return t.localStorage["auth-token"]},n=function(){var e,a=r();return!!a&&(e=a.split(".")[1],e=t.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3)},s=function(){if(n()){var e=r(),a=e.split(".")[1];return a=t.atob(a),a=JSON.parse(a),{_id:a._id,email:a.email,name:a.name,role:a.role}}return!1},o=function(){return s().role},l=function(t){return e.post("/api/register",t).success(function(e){a(e.token)})},i=function(t){return e.post("/api/register-patient",t)},c=function(t){return e.post("/api/login",t).success(function(e){a(e.token)}).error(function(e){})},d=function(){t.localStorage.removeItem("auth-token"),t.location.reload()};return{currentUser:s,currentUserRole:o,saveToken:a,getToken:r,isLoggedIn:n,register:l,registerPatient:i,login:c,logout:d}}angular.module("mainApp").factory("authentication",e),e.$inject=["$http","$window"]}(),function(){function e(e,t){var a=function(){return e.get("/api/profile")},r=function(){return e.get("/api/get-patients")},n=function(){return e.get("/api/get-doctor")},s=function(t){return e.post("/api/doctor-post-message",t)},o=function(t){return e.post("/api/patient-post-message",t)},l=function(t){return e.post("/api/toggle-message",{message:t})},i=function(){return e.get("/api/num-unread-messages")},c=function(){return console.log("getting messages"),e.get("/api/get-messages")},d=function(t){return e.post("/api/post-reply",t)},u=function(t){return e.get("/api/get-replys/"+t)},p=function(){return e.get("/api/get-exercises")},g=function(t){return console.log("Sending to server:"),e.post("/api/get-single-exercise",{exercise:t})},m=function(t){return e.post("/api/post-exercise",t)},h=function(){return e.get("/api/get-event")},f=function(){return e.get("/api/get-patientevent")},v=function(t){return console.log("dataservice: "+t),e.post("/api/get-eventByPatientId",{_id:t})},y=function(t){return e.post("/api/post-event",t)},b=function(){return e.get("/api/get-gamedata")},D=function(t){return e.post("/api/get-gamedata-by-id",{_id:t})},x=function(t){return e.post("/api/getGameDataForPatient",{patient:t})},C=function(){return console.log("getting"),e.post("/api/generate-gamedata")},w=function(t){return e.post("/api/query-gamedata-single",{date:t})},A=function(t,a,r,n){return e.post("/api/query-gamedata-range",{startDate:t,endDate:a,patient:r,exercise:n})},$=function(t,a){return e.post("/api/query-gamedata-month",{startDate:t,endDate:a})},S=function(t){return e.post("/api/post-gamedata",{date:t.date,time:t.time,code:t.code,pressure:t.pressure})};return{getProfile:a,getPatients:r,getDoctor:n,doctorPostMessage:s,patientPostMessage:o,toggleMessage:l,numUnreadMessages:i,getMessages:c,postReply:d,getReplys:u,getExercise:p,getSingleExercise:g,postExercise:m,getEvents:h,getEventByPatientId:v,postEvent:y,getPatientEvents:f,getGameData:b,getGameDataForPatient:x,getGameDataById:D,postGameData:S,querySingleDate:w,queryDateRange:A,queryMonth:$,generateGameData:C}}angular.module("mainApp").service("dataService",e),e.$inject=["$http","authentication"]}(),function(){function e(e,t){var a=this;a.isLoggedIn=t.isLoggedIn(),a.currentUser=t.currentUser(),a.signOut=function(){t.logout()}}angular.module("mainApp").controller("navigationCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("mainApp").directive("navigation",e)}();