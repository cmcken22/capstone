function menuInit(){$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")})}function setDate(e){var t=e.year,a=e.month-1,n=e.day,r=new Date(Date.UTC(t,a,n,0,0,0)),o=r.toISOString();return o}!function(){function e(e,t){"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(function(e){console.log("ServiceWorker registration failed: ",e)})}),e.when("/dashboard",{templateUrl:"doctor/dashboard/dashboard.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/profile",{templateUrl:"doctor/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/patients",{templateUrl:"doctor/patients/patients.view.html",controller:"patientsCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/patient-exercises",{templateUrl:"doctor/event/event.view.html",controller:"eventCtrl",controllerAs:"vm"}).when("/manager",{templateUrl:"doctor/manager/manager.view.html",controller:"managerCtrl",controllerAs:"vm"}).when("/messages",{templateUrl:"doctor/messages/messages.view.html",controller:"messagesCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/calendar",{templateUrl:"doctor/calendar/calendar.view.html",controller:"calendarCtrl",controllerAs:"vm"}).when("/exercises",{templateUrl:"doctor/exercises/exercises.view.html",controller:"exercisesCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/simulation",{templateUrl:"doctor/sim/sim.view.html",controller:"simCtrl"}).when("/doctor",{redirectTo:"/dashboard"}).otherwise({redirectTo:"/dashboard"}),t.html5Mode(!0)}function t(e,t,a,n){n.defaults.headers.common.Authorization="Bearer "+a.getToken()}angular.module("mainApp",["ngRoute"]),angular.module("mainApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication","$http",t])}(),function(){function e(e,t,a,n){var r=this;r.events=[],r.getEvents=function(){a.getEvents().success(function(e){r.events=e,console.log(r.events)}).error(function(e){console.log(e)})},r.allExercises=[],r.allPatients=[],r.graphDisplayed=!1,r.zoom=!1,r.options={mainGraph:"",modalGraph:""},r.options.modalGraph={scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Pressure Values"}}],xAxes:[{scaleLabel:{display:!0,labelString:"Time (Seconds)"}}]}},r.options.mainGraph={scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Average Pressure Values"}}],xAxes:[{scaleLabel:{display:!0,labelString:"gameData Objects"}}]}},r.modal={title:"",details:""},r.graphData={storedObjects:[],datasets:[],labels:[],type:"line",datasetIndex:0,index:0};var o=Chart.helpers.color;r.colors=[],r.colors[0]={light:o(window.chartColors.red).alpha(.3).rgbString(),dark:window.chartColors.red},r.colors[1]={light:o(window.chartColors.blue).alpha(.3).rgbString(),dark:window.chartColors.blue},r.colors[2]={light:o(window.chartColors.green).alpha(.3).rgbString(),dark:window.chartColors.green},r.colors[3]={light:o(window.chartColors.purple).alpha(.3).rgbString(),dark:window.chartColors.purple},r.colors[4]={light:o(window.chartColors.orange).alpha(.3).rgbString(),dark:window.chartColors.orange},$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,basicWeek,basicDay"},defaultDate:"2017-02-12",navLinks:!0,editable:!0,eventLimit:!0,events:[{title:"All Day Event",start:"2017-02-01",url:"",patient:"58a2492c17180e1a95892b86",exercise:"58a293e70457a8252eead52e"}],eventClick:function(e){if(console.log(e),$("#myModal").modal("show"),r.graph(e),e.url)return 0}}),r.graph=function(e){console.log(e.start._d);var t=new Date(e.start._d);t.setMinutes(t.getTimezoneOffset()),console.log(t),$dataService.queryDateRange(t,t,e.patient,e.exercise).success(function(e){console.log("DATA RETURNED"),console.log(e),r.updateMainGraph(e)})},r.updateMainGraph=function(e){console.log("---------Updating Chart Data---------"),console.log(e);for(var t=Chart.helpers.color,a=r.resetCanvas(),n=[],o=[],s=0;s<e[0].pressure.length;s++)n[s]=s,o[s]=e[0].pressure[s];var i={type:"line",data:{labels:n,datasets:[{label:"fuck boi",backgroundColor:t(window.chartColors.red).alpha(.3).rgbString(),borderColor:window.chartColors.red,borderWidth:1,data:o}]}};new Chart(document.getElementById("my-graph").getContext("2d"),i);a.remove(),console.log("graph created")},r.resetCanvas=function(){var e=$(".chartjs-hidden-iframe");e.remove();var t=$("#my-graph");return t.removeAttr("id"),$("#graph").append('<canvas id="my-graph">'),t}}angular.module("mainApp").controller("calendarCtrl",e),e.$inject=["$compile","$location","dataService","$scope"]}(),function(){function e(e){menuInit()}angular.module("mainApp").controller("homeCtrl",e),e.$inject=["dataService"]}(),function(){function e(e,t,a){console.log(a.currentUser()),e.sInfo={patient:"",doctor:a.currentUser()._id,exercise:null,description:"",type:null,date:"",endTime:"",gameData:null,completed:!1,skip:"1",rOption:"",repeat:null,dateFinish:""},e.date,e.startTime="",e.endTime="",e.endDate="",e.mom="",e.end="",e.allex={},e.patients={},e.skipwhat="",$(".datetime").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.date=$(this).val(),console.log($(this).val())}),$(".endDate").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.endDate=moment($(this).val(),"YYYY-MM-DD"),e.sInfo.dateFinish=e.endDate.toJSON(),console.log("repeating until "+e.endDate)}),$("#starttimepick").timepicker({timeFormat:"H:i",scrollDefault:"06:00"}).on("changeTime",function(){e.startTime=$(this).val()}),$("#endtimepick").timepicker({timeFormat:"H:i"}).on("changeTime",function(){e.endTime=$(this).val()}),$("#patient-select").select2({placeholder:"Select a patient"}),$("#patient-select").on("change",function(){e.sInfo.patient=$("#patient-select").val()}),$("#exercise-select").select2({placeholder:"Select an exercise"}),$("#exercise-select").on("change",function(){e.sInfo.exercise=$("#exercise-select").val()}),function(){for(var e=1;e<=30;e++)$(".1-100").append($("<option></option>").val(e).html(e))}(),e.getExercise=function(){t.getExercise().success(function(t){console.log(t),e.allex=t})},e.getPatients=function(){console.log("sup dude"),t.getPatients().then(function(t){e.patients=t.data})},e.addEvent=function(){e.startTime=e.startTime.split(":"),e.endTime=e.endTime.split(":"),e.mom=moment(e.date,"YYYY-MM-DD"),e.mom.set("hour",e.startTime[0]),e.mom.set("minute",e.startTime[1]),e.end=moment(e.date,"YYYY-MM-DD"),e.end.set("hour",e.endTime[0]),e.end.set("minute",e.endTime[1]),e.sInfo.date=e.mom.toJSON(),e.sInfo.endTime=e.end.toJSON(),console.log(e.sInfo.date),console.log(e.sInfo.endTime),console.log("adding event (hopefully)"),console.log(e.sInfo),t.postEvent(e.sInfo).success(function(e){console.log(e)}).error(function(e){alert(e)})}}angular.module("mainApp").controller("eventCtrl",e),e.$inject=["$scope","dataService","authentication"]}(),function(){function e(e,t,a){var n=this;n.allExercises=[],n.allPatients=[],n.graphDisplayed=!1,n.zoom=!1,n.options={mainGraph:"",modalGraph:""},n.options.modalGraph={scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Pressure Values"}}],xAxes:[{scaleLabel:{display:!0,labelString:"Time (Seconds)"}}]}},n.options.mainGraph={scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Average Pressure Values"}}],xAxes:[{scaleLabel:{display:!0,labelString:"gameData Objects"}}]}},n.form={date:"",month:"02/2017",exercise:"ALL",patient:null,startDate:"02-05-2017",endDate:"02-07-2017"},void 0!=a.param&&(console.log("PARAMS-------"),console.log("hello"),console.log(a.param.patientID),n.form.patient=a.param.patientID,document.getElementById("patient-select").innerHTML="<option>"+a.param.patientID+"</option>"),n.dummyData={date:"02-05-2017",time:7,exercise:"100"},n.modal={title:"",details:""},n.graphData={storedObjects:[],datasets:[],labels:[],type:"line",datasetIndex:0,index:0};var r=Chart.helpers.color;n.colors=[],n.colors[0]={light:r(window.chartColors.red).alpha(.3).rgbString(),dark:window.chartColors.red},n.colors[1]={light:r(window.chartColors.blue).alpha(.3).rgbString(),dark:window.chartColors.blue},n.colors[2]={light:r(window.chartColors.green).alpha(.3).rgbString(),dark:window.chartColors.green},n.colors[3]={light:r(window.chartColors.purple).alpha(.3).rgbString(),dark:window.chartColors.purple},n.colors[4]={light:r(window.chartColors.orange).alpha(.3).rgbString(),dark:window.chartColors.orange},$("#graphArea").hide(),n.initInputFields=function(){n.patientNames=[],e.getPatients().success(function(e){n.patientNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#patient-select").select2({data:n.patientNames,placeholder:"Select a patient"}),$("#patient-select-range").select2({data:n.patientNames,placeholder:"Select a patient"})}),$("#patient-select").on("change",function(){n.form.patient=$("#patient-select").val()}),$("#patient-select-range").on("change",function(){n.form.patient=$("#patient-select-range").val()}),n.exerciseNames=[],e.getExercise().success(function(e){n.allExercises=e,n.exerciseNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#exercise-select").select2({data:n.exerciseNames,placeholder:"Select an Exercise"}),$("#exercise-select-range").select2({data:n.exerciseNames,placeholder:"Select an Exercise"})}),$("#exercise-select").on("change",function(){n.form.exercise=$("#exercise-select").val()}),$("#exercise-select-range").on("change",function(){n.form.exercise=$("#exercise-select-range").val()})},n.initDatePickers=function(){$("#monthPicker").datepicker({format:"mm/yyyy",viewMode:"months",minViewMode:"months",orientation:"bottom",autoclose:!0}).on("changeDate",function(){n.form.month=$("#_monthPicker").val()}),$("#monthPicker").datepicker("update",n.form.month),$("#dummyDatePicker").datepicker({format:"mm-dd-yyyy",orientation:"bottom",autoclose:!0}).on("changeDate",function(){n.dummyData.date=$("#dummyDatePickerVal").val()}),$("#dummyDatePicker").datepicker("update",n.dummyData.date),$(".input-daterange").datepicker({format:"mm-dd-yyyy",orientation:"bottom",autoclose:!0}).on("changeDate",function(){n.form.startDate=$("#_startDate").val(),n.form.endDate=$("#_endDate").val()}),$("#_startDate").datepicker("update",n.form.startDate),$("#_endDate").datepicker("update",n.form.endDate)},n.initInputFields(),n.initDatePickers(),n.generateGameData=function(){console.log("generating random data")},n.viewALLByRange=function(){if(null==n.form.patient)return alert("Please select a patient"),0;console.log("Patient: "),console.log(n.form),n.clearObjects();for(var e=[],t=0;t<n.allExercises.length;t++)"ALL"!=n.allExercises[t].name&&(e[t]=n.allExercises[t]);var a=new Date(n.form.startDate),r=new Date(n.form.endDate);n.modal.title=a.toDateString()+" - "+r.toDateString(),$("#graphArea").slideDown(),n.createQuery(a,r,e)},n.viewALLByMonth=function(){if(null==n.form.patient)return alert("Please select a patient"),0;n.clearObjects(),console.log(n.form.exercise);for(var e=[],t=0;t<n.allExercises.length;t++)"ALL"!=n.allExercises[t].name&&(e[t]=n.allExercises[t]);var a=n.form.month.split("/"),r=a[0]+"-01-"+a[1];r=new Date(r);var o=r.getUTCMonth()+2+"-01-"+a[1];o=new Date(o),o.setDate(o.getDate()-1),n.modal.title=n.setMonthString(r.getUTCMonth()+1),$("#graphArea").slideDown(),n.createQuery(r,o,e)},n.createQuery=function(t,a,r){console.log("Creating Query"),console.log(n.form.exercise);var o=r.length;void 0!=n.form.exercise&&"ALL"!=n.form.exercise?e.queryDateRange(t,a,n.form.patient,n.form.exercise).success(function(e){0!=e.length&&(e=n.sortByDate(e),n.graphData.storedObjects[0]=e,n.graphData.datasets[0]=n.graphAVG(e,0,n.form.exercise.name)),n.updateMainGraph()}):void 0!=n.form.exercise&&"ALL"!=n.form.exercise||n.searchDatabase(t,a,n.form.patient,r,0,o)},n.searchDatabase=function(t,a,r,o,s,i){console.log("Searching DataBase");var l=o[s]._id;console.log("Exercise:"),console.log(l),console.log("Patient:"),console.log(r),e.queryDateRange(t,a,r,l).success(function(e){e=n.sortByDate(e),0!=e.length&&(n.graphData.storedObjects[s]=e,n.graphData.datasets[s]=n.graphAVG(e,s,o[s].name)),s++,s!=i?n.searchDatabase(t,a,r,o,s,i):s==i&&(console.log("UPDATE NOW"),n.updateMainGraph())})},n.clearObjects=function(){n.graphData.storedObjects=[],n.graphData.datasets=[],n.graphData.labels=[],n.datasetIndex=0,n.index=0},n.graphAVG=function(e,t,a){for(var r=[],o=[],s=0;s<e.length;s++){o[s]=s;for(var i=0,l=0;l<e[s].pressure.length;l++)i+=e[s].pressure[l];r[s]=i/e[s].pressure.length}var c={label:a,backgroundColor:n.colors[t%n.colors.length].light,borderColor:n.colors[t%n.colors.length].dark,borderWidth:1,data:r};return n.graphData.labels[t]=o,c},n.graphPressure=function(e,t,a){console.log("Graphing Pressure:"),console.log(a);for(var r=[],o=[],s=0;s<e.pressure.length;s++)console.log(e.pressure[s]),o[s]=s,r[s]=e.pressure[s];var i={label:a,backgroundColor:n.colors[t%n.colors.length].light,borderColor:n.colors[t%n.colors.length].dark,borderWidth:1,data:r};return n.graphData.labels=o,i},n.updateMainGraph=function(){console.log("---------Updating Chart Data---------");Chart.helpers.color;n.graphDisplayed=!0;var e=n.resetCanvas();console.log("vm.graphData.datasets"),console.log(n.graphData.datasets);for(var a=-1,r=[],o=0;o<n.graphData.labels.length;o++)n.graphData.labels[o].length>a&&(r=n.graphData.labels[o]);var s={type:n.graphData.type,data:{labels:r,datasets:n.graphData.datasets},options:n.options.mainGraph},i=new Chart(document.getElementById("my-graph").getContext("2d"),s);e.remove(),console.log("graph created"),document.getElementById("my-graph").onclick=function(e){var a=i.getElementAtEvent(e),r=a[0];if(void 0!==r){n.zoom=!0,n.graphData.datasetIndex=r._datasetIndex,n.graphData.index=r._index;var o=n.graphData.storedObjects[r._datasetIndex][r._index],s=new Date(o.date);s.setMinutes(s.getTimezoneOffset()),n.modal.details=s.toDateString(),n.modal.gameObject=o,$("#myModal").modal("show"),n.displayObject(o,n.graphData.datasetIndex),t.$apply()}}},n.resetCanvas=function(){var e=$(".chartjs-hidden-iframe");e.remove();var t=$("#my-graph");return t.removeAttr("id"),$("#graph").append('<canvas id="my-graph">'),t},n.updateModalGraph=function(){console.log("Updating Chart Data");Chart.helpers.color;n.graphDisplayed=!0;var e=n.resetModalCanvas();console.log("vm.graphData.datasets"),console.log(n.graphData.datasets);var t={type:n.graphData.type,data:{labels:n.graphData.labels,datasets:n.graphData.datasets},options:n.options.modalGraph};new Chart(document.getElementById("my-modalGraph").getContext("2d"),t);e.remove()},n.resetModalCanvas=function(){var e=$("#modalGraph > .chartjs-hidden-iframe");e.remove();var t=$("#my-modalGraph");return t.removeAttr("id"),$("#modalGraph").append('<canvas id="my-modalGraph">'),t},n.displayObject=function(t,a){console.log("Displaying Object:"),console.log(a),console.log(t),console.log(t.exercise),e.getSingleExercise(t.exercise).success(function(e){n.graphData.datasets=[],n.graphData.datasets[0]=n.graphPressure(t,a,e[0].name),n.modal.exercise=e[0].name,n.updateModalGraph()})},n.next=function(){console.log("Next>>>>>>>>>>>>>>>>>>>>>>>>>>");try{n.graphData.index++,console.log(n.graphData.index);var e=n.graphData.datasetIndex;console.log(e);var t=n.graphData.storedObjects[n.graphData.datasetIndex][n.graphData.index];console.log(t);var a=new Date(t.date);a.setMinutes(a.getTimezoneOffset()),console.log(a),n.modal.details=a.toDateString(),n.modal.gameObject=t,n.displayObject(t,e)}catch(e){console.log("error: "+e),n.graphData.index--}},n.prev=function(){console.log("Prev<<<<<<<<<<<<<<<<<<<<<<<<<<");try{n.graphData.index--,console.log(n.graphData.index);var e=n.graphData.datasetIndex;console.log(e);var t=n.graphData.storedObjects[n.graphData.datasetIndex][n.graphData.index];console.log(t);var a=new Date(t.date);a.setMinutes(a.getTimezoneOffset()),console.log(a),n.modal.details=a.toDateString(),n.modal.gameObject=t,n.displayObject(t,e)}catch(e){console.log("error: "+e),n.graphData.index++}},n.setMonthString=function(e){var t;return 1==e?t="Janurary":2==e?t="February":3==e?t="March":4==e?t="April":5==e?t="May":6==e?t="June":7==e?t="July":8==e?t="August":9==e?t="September":10==e?t="October":11==e?t="November":12==e&&(t="December"),t},n.changeGraphType=function(e,t){console.log("Type: "+e),n.graphData.type=e,"main"==t?n.updateMainGraph():"modal"==t&&n.updateModalGraph()},n.sortByDate=function(e){for(var t=0;t<e.length-1;t++){for(var a=t,n=t+1;n<e.length;n++)e[n].date<e[a].date&&(a=n);var r=e[t];e[t]=e[a],e[a]=r}return e},n.sortByExercise=function(e){for(var t=0;t<e.length-1;t++){for(var a=t,n=t+1;n<e.length;n++)e[n].code<e[a].code&&(a=n);var r=e[t];e[t]=e[a],e[a]=r}return e}}angular.module("mainApp").controller("exercisesCtrl",e),e.$inject=["dataService","$scope","$routeParams"]}(),function(){function e(e,t){var a=this;a.clicked=!0,a.exerciseInfo={name:"",description:""},a.allex=[],t.getExercise().success(function(t){console.log(t),e.allex=t}).error(function(e){console.log(e)}),a.addExercise=function(){console.log("add exercise pressed"),console.log(a.exerciseInfo),t.postExercise(a.exerciseInfo).success(function(e){console.log(e)}).error(function(e){alert(e)})}}angular.module("mainApp").controller("managerCtrl",e),e.$inject=["$scope","dataService"]}(),function(){function e(e,t,a){var n=this;n.currentUser=a.currentUser(),n.messages,n.receivedCount,n.sentCount,n.unreadCount,n.initUnreadCount,n.everythingLoaded=!1,n.compose={messageSubject:"",messageBody:""},n.patientNames,n.replyBody="",t.getPatients().success(function(e){n.patientNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#patient-select").select2({data:n.patientNames,placeholder:"Select a patient"}).on("change",function(e){n.compose.patientId=$("#patient-select").val()})}),n.getMessages=function(){t.getMessages().success(function(e){console.log(e),n.messages=e,n.messageCount=e.length,n.everythingLoaded=!0,n.parseMessageData()})},n.getPatientName=function(e){if(!n.patientNames)return"";var t=$.grep(n.patientNames,function(t){return t.id==e});return t[0]?t[0].text:void 0},n.activeReply,n.replyClick=function(e){n.activeReply=e,t.getReplys(e._id).success(function(e){n.activeReply.replysData=e})},n.postReply=function(){var e={body:n.replyBody,message:n.activeReply._id};t.postReply(e).success(function(e){n.replyBody="",n.replyClick(n.activeReply),jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your reply has successfully been sent.</div>')}).error(function(){jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your reply.</div>')})},n.replySenderName=function(e){var t=a.currentUser();return e==t._id?t.name:n.getPatientName(e)},n.messageSend=function(){var e={patientId:n.compose.patientId,messageSubject:n.compose.messageSubject,messageBody:n.compose.messageBody};t.doctorPostMessage(e).success(function(e){n.compose.messageSubject="",n.compose.messageBody="",n.sentCount++,jQuery("#compose .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your message has successfully been sent.</div>')}).error(function(){jQuery("#compse .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your message.</div>')})},n.readMessage=function(a){a.read||a.sender==n.currentUser._id||$("#rec-"+a._id+" .panel-heading").hasClass("message-unread")&&($("#rec-"+a._id+" .panel-heading").removeClass("message-unread"),$("#unread-"+a._id+" .panel-heading").removeClass("message-unread"),t.toggleMessage(a._id).success(function(){e.$emit("messageRead"),n.unreadCount--})),a.replys&&a.replys.length>0&&t.getReplys(a._id).success(function(e){a.replysData=e})},n.markUnread=function(a){t.toggleMessage(a._id).success(function(){n.unreadCount++,e.$emit("messageUnread"),a.read=!1,$("#rec-"+a._id+" .panel-heading").addClass("message-unread"),$("#unread-"+a._id+" .panel-heading").addClass("message-unread")})},n.isMessageRead=function(e){return e?"message-read":"message-unread"},n.parseMessageData=function(){var e=0,t=0,a=0;n.messages.forEach(function(r){r.sender==n.currentUser._id&&a++,r.receiver==n.currentUser._id&&(t++,0==r.read&&e++)}),n.sentCount=a,n.receivedCount=t,n.unreadCount=e,n.initUnreadCount=e},n.dateString=function(e){var e=new Date(e);return e.toDateString()+", "+e.toLocaleTimeString()},n.getMessages()}angular.module("mainApp").controller("messagesCtrl",e),e.$inject=["$scope","dataService","authentication"]}(),function(){function e(e,t,a,n){var r=this;r.patients,r.getPatients=function(){t.getPatients().success(function(e){r.patients=e}).error(function(e){console.log(e)})},r.getPatients(),r.registerCredentials={name:"",email:"",password:"",regDoctor:a.currentUser()._id},r.registerSubmit=function(){a.registerPatient(r.registerCredentials).success(function(e){r.registerCredentials.name="",r.registerCredentials.email="",r.registerCredentials.password="",jQuery("#add .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Patient account has successfully been created.</div>')}).error(function(e){jQuery("#add .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>User email already in use.</div>')})},r.pastMessages=[],r.getPastMessages=function(e){},r.viewData=function(t){console.log("PatientID: "),console.log(t);var a={patientID:t};e.path("/exercises").search({param:a})},r.messageSend=function(e){var a={patientId:e,messageSubject:r.messageSubject,messageBody:r.messageBody};t.postMessage(a).success(function(e){r.messageSubject="",r.messageBody="",jQuery("#view .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your message has successfully been sent.</div>')}).error(function(){jQuery("#view .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your message.</div>')})},r.togglePatient=function(e){var t="#"+e+" .toggle-section";jQuery(t).toggleClass("toggled")}}angular.module("mainApp").controller("patientsCtrl",e),e.$inject=["$location","dataService","authentication","$scope"]}(),function(){function e(e,t){var a=this;a.user={},t.getProfile().success(function(e){a.user=e}).error(function(e){console.log(e)})}angular.module("mainApp").controller("profileCtrl",e),e.$inject=["$location","dataService"]}(),function(){function e(e,t,a,n){e.gameDatas="",e.sDate="",e.eDate="",e.selected="",e.GD="",e.allex,e.allPatients,e.exercise,e.patient;var r;$(".edate").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.eDate=moment($(this).val(),"YYYY-MM-DD"),e.eDate=e.eDate.toJSON()}),$(".sdate").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.sDate=moment($(this).val(),"YYYY-MM-DD"),e.sDate=e.sDate.toJSON()}),e.getData=function(){a.getPatients().success(function(t){e.allPatients=t}),a.getExercise().success(function(t){e.allex=t})},e.getGameData=function(){a.queryDateRange(e.sDate,e.eDate,e.patient,e.exercise).success(function(t){e.gameDatas=t,console.log(t)})},e.showData=function(){console.log(e.selected),a.getGameDataById(e.selected).success(function(a){e.GD=a,console.log(e.GD[0]);var n=e.GD[0].pressureAxial.length,o=0,s=document.getElementById("simulation"),i=s.getContext("2d");r=t(function(){var t=120-e.GD[0].pressureAxial[o]/5;i.beginPath(),i.arc(e.GD[0].canvasX[o],e.GD[0].canvasY[o],5,0,2*Math.PI,!1),i.fillStyle="hsl("+t+",75%,50%)",i.fill(),i.lineWidth=1,i.closePath(),o++},100,n)})}}angular.module("mainApp").controller("simCtrl",e),e.$inject=["$scope","$interval","dataService","authentication"]}(),function(){function e(e,t,a,n,r){var o=this;o.signOut=function(){n.logout()},o.loaded=!1,o.numNewMessages,o.getNumUnread=function(){r.numUnreadMessages().success(function(e){o.numNewMessages=e.count,o.loaded=!0,o.numNewMessages>0&&$("#sidebar-messages").addClass("show-circle")})},e.$on("messageRead",function(){o.numNewMessages--,o.numNewMessages<=0&&(o.numNewMessages=0,$("#sidebar-messages").removeClass("show-circle"))}),e.$on("messageUnread",function(){o.numNewMessages++,$("#sidebar-messages").hasClass("show-circle")||$("#sidebar-messages").addClass("show-circle")}),o.sidebarInit=function(e){$("#menu-toggle").click(function(e){e.preventDefault(),$("#main-wrapper").toggleClass("toggled")}),$("sidebar ul.sidebar-nav li").each(function(){$(this).find("a").attr("href").match(e)?$(this).addClass("active"):$(this).removeClass("active")})},o.getNumUnread(),o.sidebarInit(a.path())}angular.module("mainApp").controller("sidebarCtrl",e),e.$inject=["$scope","$rootScope","$location","authentication","dataService"]}(),function(){function e(){return{templateUrl:"doctor/common/directives/sidebar/sidebar.template.html",controller:"sidebarCtrl as sidevm"}}angular.module("mainApp").directive("sidebar",e)}(),function(){function e(e,t){var a=function(e){t.localStorage["auth-token"]=e},n=function(){return t.localStorage["auth-token"]},r=function(){var e,a=n();return!!a&&(e=a.split(".")[1],e=t.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3)},o=function(){if(r()){var e=n(),a=e.split(".")[1];return a=t.atob(a),a=JSON.parse(a),console.log(a),{_id:a._id,email:a.email,name:a.name,role:a.role}}return!1},s=function(){return o().role},i=function(t){return e.post("/api/register",t).success(function(e){a(e.token)})},l=function(t){return e.post("/api/register-patient",t)},c=function(t){return e.post("/api/login",t).success(function(e){a(e.token)}).error(function(e){console.log(e)})},d=function(){t.localStorage.removeItem("auth-token"),t.location.reload()};return{currentUser:o,currentUserRole:s,saveToken:a,getToken:n,isLoggedIn:r,register:i,registerPatient:l,login:c,logout:d}}angular.module("mainApp").factory("authentication",e),e.$inject=["$http","$window"]}(),function(){function e(e,t){var a=function(){return e.get("/api/profile")},n=function(){return console.log("getPatients Service"),e.get("/api/get-patients")},r=function(){return e.get("/api/get-doctor")},o=function(t){return e.post("/api/doctor-post-message",t)},s=function(t){return e.post("/api/patient-post-message",t)},i=function(t){return e.post("/api/toggle-message",{message:t})},l=function(){return e.get("/api/num-unread-messages")},c=function(){return console.log("getting messages"),e.get("/api/get-messages")},d=function(t){return e.post("/api/post-reply",t)},g=function(t){return e.get("/api/get-replys/"+t)},u=function(){return e.get("/api/get-exercises")},p=function(t){return console.log("Sending to server:"),console.log(t),e.post("/api/get-single-exercise",{exercise:t})},m=function(t){return e.post("/api/post-exercise",t)},h=function(){return e.get("/api/get-event")},f=function(){return e.get("/api/get-patientevent")},v=function(t){return console.log("dataservice: "+t),e.post("/api/get-eventByPatientId",{_id:t})},y=function(t){return e.post("/api/post-event",t)},D=function(){return e.get("/api/get-gamedata")},b=function(t){return e.post("/api/get-gamedata-by-id",{_id:t})},x=function(t){return e.post("/api/getGameDataForPatient",{patient:t})},$=function(){return console.log("getting"),e.post("/api/generate-gamedata")},w=function(t){return e.post("/api/query-gamedata-single",{date:t})},C=function(t,a,n,r){return e.post("/api/query-gamedata-range",{startDate:t,endDate:a,patient:n,exercise:r})},S=function(t,a){return e.post("/api/query-gamedata-month",{startDate:t,endDate:a})},M=function(t){return e.post("/api/post-gamedata",{date:t.date,time:t.time,code:t.code,pressure:t.pressure})};return{getProfile:a,getPatients:n,getDoctor:r,doctorPostMessage:o,patientPostMessage:s,toggleMessage:i,numUnreadMessages:l,getMessages:c,postReply:d,getReplys:g,getExercise:u,getSingleExercise:p,postExercise:m,getEvents:h,getEventByPatientId:v,postEvent:y,getPatientEvents:f,getGameData:D,getGameDataForPatient:x,getGameDataById:b,postGameData:M,querySingleDate:w,queryDateRange:C,queryMonth:S,generateGameData:$}}angular.module("mainApp").service("dataService",e),e.$inject=["$http","authentication"]}(),function(){function e(e,t){var a=this;a.isLoggedIn=t.isLoggedIn(),a.currentUser=t.currentUser(),a.signOut=function(){t.logout()}}angular.module("mainApp").controller("navigationCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("mainApp").directive("navigation",e)}();