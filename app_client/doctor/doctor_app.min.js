function setDate(e){var t=e.year,a=e.month-1,n=e.day,r=new Date(Date.UTC(t,a,n,0,0,0)),s=r.toISOString();return s}!function(){function e(e,t){"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(function(e){console.log("ServiceWorker registration failed: ",e)})}),e.when("/dashboard",{templateUrl:"doctor/dashboard/dashboard.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/profile",{templateUrl:"doctor/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).when("/patients",{templateUrl:"doctor/patients/patients.view.html",controller:"patientsCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/exercise-manager",{templateUrl:"doctor/event/event.view.html",controller:"eventCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/manager",{templateUrl:"doctor/manager/manager.view.html",controller:"managerCtrl",controllerAs:"vm"}).when("/messages",{templateUrl:"doctor/messages/messages.view.html",controller:"messagesCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/calendar",{templateUrl:"doctor/calendar/calendar.view.html",controller:"calendarCtrl",controllerAs:"vm"}).when("/exercises",{templateUrl:"doctor/exercises/exercises.view.html",controller:"exercisesCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/simulation",{templateUrl:"doctor/sim/sim.view.html",controller:"simCtrl"}).when("/doctor",{redirectTo:"/dashboard"}).otherwise({redirectTo:"/dashboard"}),t.html5Mode(!0)}function t(e,t,a,n){n.defaults.headers.common.Authorization="Bearer "+a.getToken()}angular.module("mainApp",["ngRoute"]),angular.module("mainApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication","$http",t])}(),function(){function e(e,t,a,n,r){var s=this;s.everythingLoaded=!1,s.events=new Array,s.patient_ids=[],s.patientList=[],s.exerciseList=[],s.populatedApps=[],s.selectedPatient="Appointment",s.populatedEvents=new Array,s.updateCalendar=function(){console.log("updating calendar"),s.populateEvents(),$("#calendar").fullCalendar("removeEvents"),$("#calendar").fullCalendar("addEventSource",s.populatedEvents),$("#calendar").fullCalendar("rerenderEvents")},s.getPatients=function(){n.getPatients().then(function(e){console.log(e),e.data.forEach(function(e){s.patientList.push(e),s.patient_ids.push(e._id)}),console.log(s.patient_ids),s.getExercises(),s.getEvents()})},s.getExercises=function(){n.getExercise().then(function(e){console.log("getExercises"),console.log(e),e.data.forEach(function(e){s.exerciseList.push(e)})})},$("#select").on("change",function(){s.selectedPatient=this.value,console.log(s.selectedPatient),s.updateCalendar()}),s.getEvents=function(){n.getEventByPatientId(s.patient_ids).success(function(e){s.events=e,s.events.forEach(function(e){s.patientList.forEach(function(t){t._id==e.patient&&(e.patient=t)}),s.exerciseList.forEach(function(t){t._id==e.exercise&&(e.exercise=t)})}),s.everythingLoaded=!0,console.log(s.events),s.populateEvents(),s.cal()}).error(function(e){console.log(e)})},n.getPatients().success(function(e){s.patientNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#patient-select").select2({data:s.patientNames,placeholder:"Select a patient"}).on("change",function(e){s.compose.patientId=$("#patient-select").val()})}),s.getPatients(),s.populateEvents=function(){s.populatedEvents=[];for(var e=0,t=s.events.length;e<t;e++){var a={title:"",start:"",allDay:"",patient:"",exercise:"",gameData:"",completed:"",end:"",type:"",url:"",color:"",description:""};a.title=s.events[e].patient.name,null!=s.events[e].exercise&&(a.title=a.title+" - "+s.events[e].exercise.name),a.start=s.events[e].date,a.end=s.events[e].endTime,a.allDay=0,a.patient=s.events[e].patient,a.exercise=s.events[e].exercise,a.gameData=s.events[e].gameData,a.completed=s.events[e].completed,a.type=s.events[e].type,null!=s.events[e].exercise&&(a.description=s.events[e].exercise.name),s.selectedPatient==a.patient._id?("appointment"==a.type||"true"==a.type||1==a.type?(a.backgroundColor="#FFBF10",a.textColor="FFFFFF"):null!=a.type&&"false"!=a.type&&""!=a.type&&0!=a.type||(a.backgroundColor="#FF6c3e",a.textColor="FFFFFF"),1==a.completed&&(a.backgroundColor="#1993DC",a.textColor="FFFFFF"),s.populatedEvents.push(a)):"Appointment"==s.selectedPatient&&("appointment"!=a.type&&"true"!=a.type&&1!=a.type||(a.backgroundColor="#FFBF10",a.textColor="FFFFFF",s.populatedEvents.push(a)))}},s.allExercises=[],s.allPatients=[],s.graphDisplayed=!1,s.zoom=!1,s.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Pressure Values"}}],xAxes:[{scaleLabel:{display:!0,labelString:"Time (Seconds)"}}]}},s.modal={title:"",details:""},s.graphData={storedObjects:[],datasets:[],labels:[],type:"line",datasetIndex:0,index:0};var o=Chart.helpers.color;s.colors=[],s.colors[0]={light:o(window.chartColors.red).alpha(.3).rgbString(),dark:window.chartColors.red},s.colors[1]={light:o(window.chartColors.blue).alpha(.3).rgbString(),dark:window.chartColors.blue},s.colors[2]={light:o(window.chartColors.green).alpha(.3).rgbString(),dark:window.chartColors.green},s.colors[3]={light:o(window.chartColors.purple).alpha(.3).rgbString(),dark:window.chartColors.purple},s.colors[4]={light:o(window.chartColors.orange).alpha(.3).rgbString(),dark:window.chartColors.orange},s.cal=function(){$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,basicWeek,basicDay"},timezone:"local",defaultDate:"2017-02-12",navLinks:!0,editable:!0,eventLimit:!0,events:s.populatedEvents,eventClick:function(e){if($("#myModal").modal("show"),s.graph(e),e.url)return 0},eventRender:function(e){e.patient,e.exercise,e.gameData,e.completed,e.type,e.description}})},s.gameObject="",s.graph=function(e){n.getGameDataById(e.gameData).then(function(e){s.gameObject=e.data[0],s.updateMainGraph(e.data[0])})},s.updateMainGraph=function(e){console.log("---------Updating Chart Data---------"),console.log(e);for(var t=s.resetCanvas(),a=[],n=[],r=[],o=[],i=[],l=0;l<e.pressureAxial.length;l++)i[l]=l,a[l]=e.pressureAxial[l],n[l]=e.pressureA[l],r[l]=e.pressureB[l],o[l]=e.pressureC[l];var c=0,d=[{label:"Axial",backgroundColor:s.colors[c%s.colors.length].light,borderColor:s.colors[c++%s.colors.length].dark,borderWidth:1,data:a},{label:"A",backgroundColor:s.colors[c%s.colors.length].light,borderColor:s.colors[c++%s.colors.length].dark,borderWidth:1,data:n},{label:"B",backgroundColor:s.colors[c%s.colors.length].light,borderColor:s.colors[c++%s.colors.length].dark,borderWidth:1,data:r},{label:"C",backgroundColor:s.colors[c%s.colors.length].light,borderColor:s.colors[c++%s.colors.length].dark,borderWidth:1,data:o}],u={type:"line",data:{labels:i,datasets:d},options:s.options};new Chart(document.getElementById("my-graph").getContext("2d"),u);t.remove()},s.resetCanvas=function(){var e=$(".chartjs-hidden-iframe");e.remove();var t=$("#my-graph");return t.removeAttr("id"),$("#graph").append('<canvas id="my-graph">'),t}}angular.module("mainApp").controller("calendarCtrl",e),e.$inject=["$compile","$location","authentication","dataService","$scope"]}(),function(){function e(e,t,a){var n=this;n.activeReply,n.patientNames,n.currentUser=e.currentUser(),n.unreadCount,n.patients,t.getPatients().success(function(e){n.patients=e,n.patientNames=e.map(function(e){return{id:e._id,text:e.name}})}),t.getMessages().then(function(e){n.messages=e.data,n.parseMessageData()}),n.replyClick=function(e){n.activeReply=e,t.getReplys(e._id).success(function(e){n.activeReply.replysData=e})},n.parseMessageData=function(){var e=0;n.messages.forEach(function(t){t.receiver==n.currentUser._id&&0==t.read&&e++}),n.unreadCount=e},n.getSenderName=function(e){return e==n.currentUser._id?n.currentUser.name:n.patientName(e)},n.patientName=function(e){if(!n.patientNames)return"";var t=$.grep(n.patientNames,function(t){return t.id==e});return t[0]?t[0].text:void 0},n.postReply=function(){var e={body:n.replyBody,message:n.activeReply._id};t.postReply(e).success(function(e){n.replyBody="",n.replyClick(n.activeReply),jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your reply has successfully been sent.</div>')}).error(function(){jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your reply.</div>')})},n.togglePatient=function(e){var t="#"+e+" .toggle-section";jQuery(t).toggleClass("toggled")},n.messageSend=function(e){var a={patientId:e,messageSubject:n.messageSubject,messageBody:n.messageBody};t.doctorPostMessage(a).success(function(e){n.messageSubject="",n.messageBody="",jQuery("#dash-messaging .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your message has successfully been sent.</div>')}).error(function(){jQuery("#dash-messaging .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your message.</div>')})},n.viewData=function(e){var t={patientID:e};a.path("/exercises").search({param:t})}}angular.module("mainApp").controller("homeCtrl",e),e.$inject=["authentication","dataService","$location"]}(),function(){function e(e,t,a,n){e.sInfo={patient:null,doctor:a.currentUser()._id,exercise:null,description:"",rOption:"days",skip:1,type:!1,date:"",endTime:"",gameData:null,completed:!1,repeat:!1,dateFinish:"",timeLimit:"",alphaFilter:"",gripThreshold:"",axialThreshold:""},e.date,e.startTime="",e.endTime="",e.endDate="",e.mom="",e.end="",e.allex={},e.patients={},$(".datetime").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.date=$(this).val(),console.log($(this).val())}),$(".endDate").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.endDate=moment($(this).val(),"YYYY-MM-DD"),e.sInfo.dateFinish=e.endDate.toJSON(),console.log("repeating until "+e.endDate)}),$("#starttimepick").timepicker({timeFormat:"H:i",scrollDefault:"06:00"}).on("changeTime",function(){e.startTime=$(this).val()}),$("#endtimepick").timepicker({timeFormat:"H:i"}).on("changeTime",function(){e.endTime=$(this).val()}),$("#exercise-select").select2({placeholder:"Select an exercise"}),$("#exercise-select").on("change",function(){e.sInfo.exercise=$("#exercise-select").val()}),function(){for(var e=1;e<=30;e++)$(".1-100").append($("<option></option>").val(e).html(e))}(),e.getExercise=function(){t.getExercise().success(function(t){e.allex=t})},e.getPatients=function(){t.getPatients().success(function(t){e.patients=t})};var r=this;r.addEvent=function(){e.startTime=e.startTime.split(":"),e.endTime=e.endTime.split(":"),e.mom=moment(e.date,"YYYY-MM-DD"),e.mom.set("hour",e.startTime[0]),e.mom.set("minute",e.startTime[1]),e.end=moment(e.date,"YYYY-MM-DD"),e.end.set("hour",e.endTime[0]),e.end.set("minute",e.endTime[1]),e.sInfo.date=e.mom.toJSON(),e.sInfo.endTime=e.end.toJSON(),t.postEvent(e.sInfo).success(function(e){jQuery("#new-event .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>The event was successfully saved.</div>')}).error(function(e){jQuery("#new-event .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error saving the event.</div>')})},r.exerciseInfo={name:"",description:""},r.addExercise=function(){t.postExercise(r.exerciseInfo).success(function(e){console.log(e)}).success(function(e){r.exerciseInfo.name="",r.exerciseInfo.description="",jQuery("#new-exercise .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your exercise was successfully saved.</div>')}).error(function(e){jQuery("#new-exercise .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error saving the exercise.</div>')})},e.getPatients(),e.getExercise(),$("#patient-select").select2({data:e.patients,placeholder:"Select a patient"}),$("#patient-select").on("change",function(){e.sInfo.patient=$("#patient-select").val()}),void 0!=n.param&&(console.log("PARAMS-------"),console.log(n.param.patientID),e.patient=n.param.patientID,document.getElementById("patient-select").innerHTML="<option>"+n.param.patientID+"</option>",console.log(document.getElementById("patient-select").innerHTML))}angular.module("mainApp").controller("eventCtrl",e),e.$inject=["$scope","dataService","authentication","$routeParams"]}(),function(){function e(e,t,a){var n=this;n.allExercises=[],n.allPatients=[],n.originalObject=null,n.graphDisplayed=!1,n.zoom=!1,n.showSim=!1,n.mainGraph={labels:{yAxes:"Average Pressure Values",xAxes:"Game Objects"}},n.mainGraph.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:n.mainGraph.labels.yAxes}}],xAxes:[{scaleLabel:{display:!0,labelString:n.mainGraph.labels.xAxes}}]}},n.modalGraph={labels:{yAxes:"Pressure Values",xAxes:"Time (Seconds)"}},n.modalGraph.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:n.modalGraph.labels.yAxes}}],xAxes:[{scaleLabel:{display:!0,labelString:n.modalGraph.labels.xAxes},ticks:{autoSkip:!1}}]}},n.refreshOptions=function(){n.mainGraph.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:n.mainGraph.labels.yAxes}}],xAxes:[{scaleLabel:{display:!0,labelString:n.mainGraph.labels.xAxes}}]}},n.modalGraph.options={scales:{yAxes:[{scaleLabel:{display:!0,labelString:n.modalGraph.labels.yAxes}}],xAxes:[{scaleLabel:{display:!0,labelString:n.modalGraph.labels.xAxes},ticks:{autoSkip:!1}}]}}},n.currentDate={date:"",day:"",month:"",year:"",string:""},n.nextDate={date:"",day:"",month:"",year:"",string:""},n.setFormDate=function(){n.currentDate.date=new Date,n.currentDate.date.setHours(0,0,0,0),console.log("CURRENT DATE: "+n.currentDate.date),n.currentDate.day=n.currentDate.date.getUTCDate(),n.currentDate.month=n.currentDate.date.getUTCMonth()+1,n.currentDate.year=n.currentDate.date.getFullYear(),n.currentDate.string=n.currentDate.month+"-"+n.currentDate.day+"-"+n.currentDate.year,console.log("CURRENT DATE STRING: "+n.currentDate.string),n.nextDate.date=new Date,n.nextDate.date.setHours(0,0,0,0),n.nextDate.date.setDate(n.nextDate.date.getDate()+7),console.log("NEXT DATE: "+n.nextDate.date),n.nextDate.day=n.nextDate.date.getUTCDate(),n.nextDate.month=n.nextDate.date.getUTCMonth()+1,n.nextDate.year=n.nextDate.date.getFullYear(),n.nextDate.string=n.nextDate.month+"-"+n.nextDate.day+"-"+n.nextDate.year,console.log("NEXT DATE STRING: "+n.nextDate.string)},n.setFormDate(),n.form={date:"",month:n.currentDate.month+"/"+n.currentDate.year,exercise:null,patient:null,startDate:n.currentDate.string,endDate:n.nextDate.string},void 0!=a.param&&(console.log("PARAMS-------"),console.log(a.param.patientID),n.form.patient=a.param.patientID,document.getElementById("patient-select").innerHTML="<option>"+a.param.patientID+"</option>"),n.modal={title:"",details:""},n.graphData={storedObjects:[],datasets:[],labels:[],type:"line",pressureType:0,index:0};var r=Chart.helpers.color;n.colors=[],n.colors[0]={light:r(window.chartColors.red).alpha(.3).rgbString(),dark:window.chartColors.red},n.colors[1]={light:r(window.chartColors.blue).alpha(.3).rgbString(),dark:window.chartColors.blue},n.colors[2]={light:r(window.chartColors.green).alpha(.3).rgbString(),dark:window.chartColors.green},n.colors[3]={light:r(window.chartColors.purple).alpha(.3).rgbString(),dark:window.chartColors.purple},n.colors[4]={light:r(window.chartColors.orange).alpha(.3).rgbString(),dark:window.chartColors.orange},$("#graphArea").hide(),n.initInputFields=function(){n.patientNames=[],e.getPatients().success(function(e){n.patientNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#patient-select").select2({data:n.patientNames,placeholder:"Select a patient"}),$("#patient-select-range").select2({data:n.patientNames,placeholder:"Select a patient"})}),$("#patient-select").on("change",function(){n.form.patient=$("#patient-select").val()}),$("#patient-select-range").on("change",function(){n.form.patient=$("#patient-select-range").val()}),n.exerciseNames=[],e.getExercise().success(function(e){n.allExercises=e,n.exerciseNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#exercise-select").select2({data:n.exerciseNames,placeholder:"Select an Exercise"}),$("#exercise-select-range").select2({data:n.exerciseNames,placeholder:"Select an Exercise"})}),$("#exercise-select").on("change",function(){n.form.exercise=$("#exercise-select").val()}),$("#exercise-select-range").on("change",function(){n.form.exercise=$("#exercise-select-range").val()})},n.initDatePickers=function(){$("#monthPicker").datepicker({format:"mm/yyyy",viewMode:"months",minViewMode:"months",orientation:"bottom",autoclose:!0}).on("changeDate",function(){n.form.month=$("#_monthPicker").val()}),$("#monthPicker").datepicker("update",n.form.month),$("#_startDate").datepicker("update",n.form.startDate),$("#_endDate").datepicker("update",n.form.endDate),$(".input-daterange").datepicker({format:"mm-dd-yyyy",orientation:"bottom",autoclose:!0}).on("changeDate",function(){n.form.startDate=$("#_startDate").val(),n.form.endDate=$("#_endDate").val()})},n.initInputFields(),n.initDatePickers(),n.viewALLByRange=function(){if(null==n.form.exercise)return alert("Please select an exercise"),0;if(null==n.form.patient)return alert("Please select a patient"),0;console.log("Form: "),console.log(n.form),n.clearObjects();var e=new Date(n.form.startDate),t=new Date(n.form.endDate);n.modal.title=e.toDateString()+" - "+t.toDateString(),$("#graphArea").slideDown(),n.createQuery(e,t)},n.viewALLByMonth=function(){if(null==n.form.exercise)return alert("Please select an exercise"),0;if(null==n.form.patient)return alert("Please select a patient"),0;n.clearObjects(),console.log(n.form.exercise);var e=n.form.month.split("/"),t=e[0]+"-01-"+e[1];t=new Date(t);var a=t.getUTCMonth()+2+"-01-"+e[1];a=new Date(a),a.setDate(a.getDate()-1),n.modal.title=n.setMonthString(t.getUTCMonth()+1),n.createQuery(t,a)},n.createQuery=function(t,a){e.queryDateRange(t,a,n.form.patient,n.form.exercise).success(function(e){console.clear(),console.log(e.length),console.log(e),0!=e.length?($("#graphArea").slideDown(),e=n.sortByDate(e),n.graphData.datasets=n.graphALLavg(e,n.form.exercise.name),n.updateMainGraph()):0==e.length&&alert("Error: no data found.")})},n.graphALLavg=function(e,t){console.log("GRAPHING ALL AVG");for(var a=[],r=[],s=[],o=[],i=[],l=0;l<e.length;l++){var c=0,d=0,u=0,g=0;i[l]=l,n.graphData.storedObjects[l]=e[l];for(var p=0;p<e[l].pressureAxial.length;p++)c+=e[l].pressureAxial[p],d+=e[l].pressureA[p],u+=e[l].pressureB[p],g+=e[l].pressureC[p];a[l]=c/e[l].pressureAxial.length,r[l]=d/e[l].pressureA.length,s[l]=u/e[l].pressureB.length,o[l]=g/e[l].pressureC.length}n.graphData.labels=i;var m=0,h=[{label:"Axial",backgroundColor:n.colors[m%n.colors.length].light,borderColor:n.colors[m++%n.colors.length].dark,borderWidth:1,data:a},{label:"A",backgroundColor:n.colors[m%n.colors.length].light,borderColor:n.colors[m++%n.colors.length].dark,borderWidth:1,data:r},{label:"B",backgroundColor:n.colors[m%n.colors.length].light,borderColor:n.colors[m++%n.colors.length].dark,borderWidth:1,data:s},{label:"C",backgroundColor:n.colors[m%n.colors.length].light,borderColor:n.colors[m++%n.colors.length].dark,borderWidth:1,data:o}];return h},n.clearObjects=function(){n.graphData.storedObjects=[],n.graphData.datasets=[],n.graphData.labels=[],n.datasetIndex=0,n.index=0},n.clearForm=function(){n.form={date:"",month:n.currentDate.month+"/"+n.currentDate.year,exercise:null,patient:null,startDate:n.currentDate.string,endDate:n.nextDate.string},$("#exercise-select").select2("val",null),$("#exercise-select-range").select2("val",null),$("#patient-select").select2("val",null),$("#patient-select-range").select2("val",null)},n.clearGraph=function(){console.clear(),console.log("CLEARING GRAPH"),n.clearObjects(),n.clearForm();var e=n.resetCanvas();e.remove(),$("#graphArea").hide()},n.graphPressure=function(e,t,a){console.log("Graphing Pressure:"),console.log(a);var r=[],s=[],o=0,i="";switch(t){case 0:n.modalGraph.labels.yAxes="Pressure (Axial)",n.refreshOptions(),i=e.pressureAxial;break;case 1:n.modalGraph.labels.yAxes="Pressure (A)",n.refreshOptions(),i=e.pressureA;break;case 2:n.modalGraph.labels.yAxes="Pressure (B)",n.refreshOptions(),i=e.pressureB;break;case 3:n.modalGraph.labels.yAxes="Pressure (C)",n.refreshOptions(),i=e.pressureC}for(var l=0;l<i.length;l++)l%50==0?(s[l]=o,o++):s[l]="",r[l]=i[l];var c={label:a,backgroundColor:n.colors[t%n.colors.length].light,borderColor:n.colors[t%n.colors.length].dark,borderWidth:1,data:r};return n.graphData.labels=s,c},n.updateMainGraph=function(){console.log("-------------------\n Updating Chart Data \n-------------------"),n.graphDisplayed=!0;var e=n.resetCanvas();console.log("vm.graphData.datasets"),console.log(n.graphData.datasets);for(var a=-1,r=[],s=0;s<n.graphData.labels.length;s++)n.graphData.labels[s].length>a&&(r=n.graphData.labels[s]);var o={type:n.graphData.type,data:{labels:n.graphData.labels,datasets:n.graphData.datasets},options:n.mainGraph.options},i=new Chart(document.getElementById("my-graph").getContext("2d"),o);e.remove(),console.log("graph created"),document.getElementById("my-graph").onclick=function(e){var a=i.getElementAtEvent(e),r=a[0];if(void 0!==r){n.zoom=!0,n.graphData.pressureType=r._datasetIndex,n.graphData.index=r._index,console.log("pointIndex: "+n.graphData.index);var s=n.graphData.storedObjects[n.graphData.index];console.log("DATA OBJECT: "),console.log(s);var o=new Date(s.date);o.setHours(0,0,0,0),console.log(o),n.modal.details=o.toDateString(),n.modal.gameObject=s,n.originalObject=s,$("#myModal").modal("show"),n.displayObject(s),t.$apply()}}},n.resetCanvas=function(){var e=$(".chartjs-hidden-iframe");e.remove();var t=$("#my-graph");return t.removeAttr("id"),$("#graph").append('<canvas id="my-graph">'),t},n.updateModalGraph=function(){console.clear(),console.log("Updating Modal Graph"),n.graphDisplayed=!0;var e=n.resetModalCanvas();console.log("vm.graphData.datasets"),console.log(n.graphData.datasets),console.log(n.modalGraph);var t={type:n.graphData.type,data:{labels:n.graphData.labels,datasets:n.graphData.datasets},options:n.modalGraph.options};new Chart(document.getElementById("my-modalGraph").getContext("2d"),t),e.remove()},n.resetModalCanvas=function(){var e=$("#modalGraph > .chartjs-hidden-iframe");e.remove();var t=$("#my-modalGraph");return t.removeAttr("id"),$("#modalGraph").append('<canvas id="my-modalGraph">'),t},n.displayObject=function(t){console.log("Displaying Object:"),console.log(t),console.log(t.exercise),e.getSingleExercise(t.exercise).success(function(e){n.graphData.datasets=[],n.graphData.datasets[0]=n.graphPressure(t,n.graphData.pressureType,e[0].name),n.modal.exercise=e[0].name,n.updateModalGraph()})},n.next=function(){console.log("Next>>>>>>>>>>>>>>>>>>>>>>>>>>");try{n.graphData.index++,console.log(n.graphData.index);var e=n.graphData.storedObjects[n.graphData.index];n.originalObject=e,console.log(e);var t=new Date(e.date);t.setMinutes(0,0,0,0),console.log(t),n.modal.details=t.toDateString(),n.modal.gameObject=e,n.displayObject(e)}catch(e){console.log("error: "+e),n.graphData.index--}},n.prev=function(){console.log("Prev<<<<<<<<<<<<<<<<<<<<<<<<<<");try{n.graphData.index--,console.log(n.graphData.index);var e=n.graphData.storedObjects[n.graphData.index];n.originalObject=e,console.log(e);var t=new Date(e.date);t.setHours(0,0,0,0),console.log(t),n.modal.details=t.toDateString(),n.modal.gameObject=e,n.displayObject(e)}catch(e){console.log("error: "+e),n.graphData.index++}},n.setMonthString=function(e){var t;return 1==e?t="Janurary":2==e?t="February":3==e?t="March":4==e?t="April":5==e?t="May":6==e?t="June":7==e?t="July":8==e?t="August":9==e?t="September":10==e?t="October":11==e?t="November":12==e&&(t="December"),t},n.changeGraphType=function(e,t){console.log("Type: "+e),n.graphData.type=e,"main"==t?n.updateMainGraph():"modal"==t&&n.updateModalGraph()},n.sortByDate=function(e){for(var t=0;t<e.length-1;t++){for(var a=t,n=t+1;n<e.length;n++)e[n].date<e[a].date&&(a=n);var r=e[t];e[t]=e[a],e[a]=r}return e},n.sortByExercise=function(e){for(var t=0;t<e.length-1;t++){for(var a=t,n=t+1;n<e.length;n++)e[n].code<e[a].code&&(a=n);var r=e[t];e[t]=e[a],e[a]=r}return e}}angular.module("mainApp").controller("exercisesCtrl",e),e.$inject=["dataService","$scope","$routeParams"]}(),function(){function e(e,t,a){var n=this;n.clicked=!0,n.exerciseInfo={name:"",description:""},n.allex=[],t.getExercise().success(function(t){console.log(t),e.allex=t}).error(function(e){console.log(e)}),n.addExercise=function(){console.log("add exercise pressed"),console.log(n.exerciseInfo),t.postExercise(n.exerciseInfo).success(function(e){console.log(e)}).error(function(e){alert(e)})}}angular.module("mainApp").controller("managerCtrl",e),e.$inject=["$scope","dataService","$routeParams"]}(),function(){function e(e,t,a){var n=this;n.currentUser=a.currentUser(),n.messages,n.receivedCount,n.sentCount,n.unreadCount,n.initUnreadCount,n.everythingLoaded=!1,n.compose={messageSubject:"",messageBody:""},n.patientNames,n.replyBody="",t.getPatients().success(function(e){n.patientNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#patient-select").select2({data:n.patientNames,placeholder:"Select a patient"}).on("change",function(e){n.compose.patientId=$("#patient-select").val()})}),n.getMessages=function(){t.getMessages().success(function(e){console.log(e),n.messages=e,n.messageCount=e.length,n.everythingLoaded=!0,n.parseMessageData()})},n.getPatientName=function(e){if(!n.patientNames)return"";var t=$.grep(n.patientNames,function(t){return t.id==e});return t[0]?t[0].text:void 0},n.activeReply,n.replyClick=function(e){n.activeReply=e,t.getReplys(e._id).success(function(e){n.activeReply.replysData=e})},n.postReply=function(){var e={body:n.replyBody,message:n.activeReply._id};t.postReply(e).success(function(e){n.replyBody="",n.replyClick(n.activeReply),jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your reply has successfully been sent.</div>')}).error(function(){jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your reply.</div>')})},n.replySenderName=function(e){var t=a.currentUser();return e==t._id?t.name:n.getPatientName(e)},n.messageSend=function(){var e={patientId:n.compose.patientId,messageSubject:n.compose.messageSubject,messageBody:n.compose.messageBody};t.doctorPostMessage(e).success(function(e){n.compose.messageSubject="",n.compose.messageBody="",n.sentCount++,jQuery("#compose .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your message has successfully been sent.</div>')}).error(function(){jQuery("#compse .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your message.</div>')})},n.readMessage=function(a){a.read||a.sender==n.currentUser._id||$("#rec-"+a._id+" .panel-heading").hasClass("message-unread")&&($("#rec-"+a._id+" .panel-heading").removeClass("message-unread"),$("#unread-"+a._id+" .panel-heading").removeClass("message-unread"),t.toggleMessage(a._id).success(function(){e.$emit("messageRead"),n.unreadCount--})),a.replys&&a.replys.length>0&&t.getReplys(a._id).success(function(e){a.replysData=e})},n.markUnread=function(a){t.toggleMessage(a._id).success(function(){n.unreadCount++,e.$emit("messageUnread"),a.read=!1,$("#rec-"+a._id+" .panel-heading").addClass("message-unread"),$("#unread-"+a._id+" .panel-heading").addClass("message-unread")})},n.isMessageRead=function(e){return e?"message-read":"message-unread"},n.parseMessageData=function(){var e=0,t=0,a=0;n.messages.forEach(function(r){r.sender==n.currentUser._id&&a++,r.receiver==n.currentUser._id&&(t++,0==r.read&&e++)}),n.sentCount=a,n.receivedCount=t,n.unreadCount=e,n.initUnreadCount=e},n.dateString=function(e){var e=new Date(e);return e.toDateString()+", "+e.toLocaleTimeString()},n.getMessages()}angular.module("mainApp").controller("messagesCtrl",e),e.$inject=["$scope","dataService","authentication"]}(),function(){function e(e,t,a,n,r){var s=this;s.patients,s.getPatients=function(){t.getPatients().success(function(e){s.patients=e}).error(function(e){console.log(e)})},s.getPatients(),s.registerCredentials={name:"",email:"",password:"",regDoctor:a.currentUser()._id},s.registerSubmit=function(){a.registerPatient(s.registerCredentials).success(function(e){s.registerCredentials.name="",s.registerCredentials.email="",s.registerCredentials.password="",jQuery("#add .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Patient account has successfully been created.</div>')}).error(function(e){jQuery("#add .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>User email already in use.</div>')})},s.pastMessages=[],s.getPastMessages=function(e){},s.viewData=function(t){console.log("PatientID: "),console.log(t);var a={patientID:t};e.path("/exercises").search({param:a})},s.manageExercises=function(t){console.log("PatientID: "),console.log(t);var a={patientID:t};e.path("/exercise-manager").search({param:a})},s.messageSend=function(e){var a={patientId:e,messageSubject:s.messageSubject,messageBody:s.messageBody};t.doctorPostMessage(a).success(function(e){s.messageSubject="",s.messageBody="",jQuery("#view .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your message has successfully been sent.</div>')}).error(function(){jQuery("#view .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your message.</div>')})},s.togglePatient=function(e){var t="#"+e+" .toggle-section";jQuery(t).toggleClass("toggled")}}angular.module("mainApp").controller("patientsCtrl",e),e.$inject=["$location","dataService","authentication","$scope","$routeParams"]}(),function(){function e(e,t){var a=this;a.user={},t.getProfile().success(function(e){a.user=e}).error(function(e){console.log(e)})}angular.module("mainApp").controller("profileCtrl",e),e.$inject=["$location","dataService"]}(),function(){function e(e,t,a,n){e.gameDatas="",e.sDate="",e.eDate="",e.selected="",e.GD="",e.allex,e.allPatients,e.exercise,e.patient,e.context;var r;$(".edate").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.eDate=moment($(this).val(),"YYYY-MM-DD"),e.eDate=e.eDate.toJSON()}),$(".sdate").datepicker({format:"yyyy-mm-dd"}).on("changeDate",function(){e.sDate=moment($(this).val(),"YYYY-MM-DD"),e.sDate=e.sDate.toJSON()}),e.getData=function(){a.getPatients().success(function(t){e.allPatients=t}),a.getExercise().success(function(t){e.allex=t})},e.getGameData=function(){a.queryDateRange(e.sDate,e.eDate,e.patient,e.exercise).success(function(t){e.gameDatas=t,console.log(t)})},e.setGD=function(){a.getGameDataById(e.selected).success(function(t){e.GD=t,e.showData(e.GD[0])})},e.showData=function(a){var n=e.context;n.fillStyle="#FFFFFF",n.fillRect(50,50,650,400),console.log(a);var s=a.pressureAxial.length,o=0;
r=t(function(){var e=120-a.pressureAxial[o]/8.3;if(n.fillStyle="#7cc9f4",n.beginPath(),n.arc(800,50,23,Math.PI,1.5*Math.PI,!1),n.arc(950,50,23,1.5*Math.PI,0,!1),n.arc(950,450,23,0,.5*Math.PI,!1),n.arc(800,450,23,.5*Math.PI,Math.PI,!1),n.closePath(),n.fill(),n.fillStyle="hsl("+e+",75%,50%)",n.strokeStyle="hsl("+e+",75%,50%)",n.lineWidth=3,o>0){var t=Math.abs(a.canvasX[o]-a.canvasX[o+1]),r=Math.abs(a.canvasY[o]-a.canvasY[o+1]);console.log(t+"vs"+r),n.lineWidth=3,(t<100&&t>1||r<100&&r>1)&&(n.beginPath(),n.moveTo(a.canvasX[o]/3.41+50,400-a.canvasY[o]/2.92+50),n.lineTo(a.canvasX[o+1]/3.41+50,400-a.canvasY[o+1]/2.92+50),n.stroke())}n.beginPath(),n.arc(875,125,a.pressureA[o]/7,0,2*Math.PI,!1),n.fillStyle="#5642f4",n.fill(),n.closePath(),n.beginPath(),n.arc(875,250,a.pressureB[o]/7,0,2*Math.PI,!1),n.fillStyle="#ae3de2",n.fill(),n.closePath(),n.beginPath(),n.arc(875,375,a.pressureC[o]/7,0,2*Math.PI,!1),n.fillStyle="#dd1ab6",n.fill(),n.closePath(),n.font="30px Arial",n.fillStyle="#FFFFFF",n.textAlign="center",n.fillText("Thumb",875,100),n.fillText("Index",875,200),n.fillText("Middle",875,325),o++},20,s)},e.initFromModal=function(t){console.log(t),e.showData(t)},e.initCanvas=function(){var t=document.getElementById("simulation"),a=t.getContext("2d");a.strokeStyle="#2FA4E7",a.fillStyle="#7cc9f4",a.lineWidth=3,a.beginPath(),a.arc(25,25,23,Math.PI,1.5*Math.PI,!1),a.arc(975,25,23,1.5*Math.PI,0,!1),a.arc(975,475,23,0,.5*Math.PI,!1),a.arc(25,475,23,.5*Math.PI,Math.PI,!1),a.closePath(),a.stroke(),a.beginPath(),a.arc(800,50,23,Math.PI,1.5*Math.PI,!1),a.arc(950,50,23,1.5*Math.PI,0,!1),a.arc(950,450,23,0,.5*Math.PI,!1),a.arc(800,450,23,.5*Math.PI,Math.PI,!1),a.closePath(),a.fill(),a.stroke(),a.font="30px Arial",a.fillStyle="#2FA4E7",a.textAlign="center",a.fillText("Click to start",400,250),e.context=a}}angular.module("mainApp").controller("simCtrl",e),e.$inject=["$scope","$interval","dataService","authentication"]}(),function(){function e(e,t,a,n,r){var s=this;s.signOut=function(){n.logout()},s.loaded=!1,s.numNewMessages,s.getNumUnread=function(){r.numUnreadMessages().success(function(e){s.numNewMessages=e.count,s.loaded=!0,s.numNewMessages>0&&$("#sidebar-messages").addClass("show-circle")})},e.$on("messageRead",function(){s.numNewMessages--,s.numNewMessages<=0&&(s.numNewMessages=0,$("#sidebar-messages").removeClass("show-circle"))}),e.$on("messageUnread",function(){s.numNewMessages++,$("#sidebar-messages").hasClass("show-circle")||$("#sidebar-messages").addClass("show-circle")}),s.sidebarInit=function(e){$("#menu-toggle").click(function(e){e.preventDefault(),$("#main-wrapper").toggleClass("toggled")}),$("sidebar ul.sidebar-nav li").each(function(){$(this).find("a").attr("href").match(e)?$(this).addClass("active"):$(this).removeClass("active")})},s.getNumUnread(),s.sidebarInit(a.path())}angular.module("mainApp").controller("sidebarCtrl",e),e.$inject=["$scope","$rootScope","$location","authentication","dataService"]}(),function(){function e(){return{templateUrl:"doctor/common/directives/sidebar/sidebar.template.html",controller:"sidebarCtrl as sidevm"}}angular.module("mainApp").directive("sidebar",e)}(),function(){function e(e,t){var a=function(e){t.localStorage["auth-token"]=e},n=function(){return t.localStorage["auth-token"]},r=function(){var e,a=n();return!!a&&(e=a.split(".")[1],e=t.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3)},s=function(){if(r()){var e=n(),a=e.split(".")[1];return a=t.atob(a),a=JSON.parse(a),{_id:a._id,email:a.email,name:a.name,role:a.role}}return!1},o=function(){return s().role},i=function(t){return e.post("/api/register",t).success(function(e){a(e.token)})},l=function(t){return e.post("/api/register-patient",t)},c=function(t){return e.post("/api/login",t).success(function(e){a(e.token)}).error(function(e){})},d=function(){t.localStorage.removeItem("auth-token"),t.location.reload()};return{currentUser:s,currentUserRole:o,saveToken:a,getToken:n,isLoggedIn:r,register:i,registerPatient:l,login:c,logout:d}}angular.module("mainApp").factory("authentication",e),e.$inject=["$http","$window"]}(),function(){function e(e,t){var a=function(){return e.get("/api/profile")},n=function(){return e.get("/api/get-patients")},r=function(){return e.get("/api/get-doctor")},s=function(t){return e.post("/api/doctor-post-message",t)},o=function(t){return e.post("/api/patient-post-message",t)},i=function(t){return e.post("/api/toggle-message",{message:t})},l=function(){return e.get("/api/num-unread-messages")},c=function(){return console.log("getting messages"),e.get("/api/get-messages")},d=function(t){return e.post("/api/post-reply",t)},u=function(t){return e.get("/api/get-replys/"+t)},g=function(){return e.get("/api/get-exercises")},p=function(t){return console.log("Sending to server:"),e.post("/api/get-single-exercise",{exercise:t})},m=function(t){return e.post("/api/post-exercise",t)},h=function(){return e.get("/api/get-event")},f=function(){return e.get("/api/get-patientevent")},v=function(t){return console.log("dataservice: "+t),e.post("/api/get-eventByPatientId",{_id:t})},y=function(t){return e.post("/api/post-event",t)},b=function(){return e.get("/api/get-gamedata")},D=function(t){return e.post("/api/get-gamedata-by-id",{_id:t})},x=function(t){return e.post("/api/getGameDataForPatient",{patient:t})},C=function(){return console.log("getting"),e.post("/api/generate-gamedata")},$=function(t){return e.post("/api/query-gamedata-single",{date:t})},w=function(t,a,n,r){return e.post("/api/query-gamedata-range",{startDate:t,endDate:a,patient:n,exercise:r})},A=function(t,a){return e.post("/api/query-gamedata-month",{startDate:t,endDate:a})},P=function(t){return e.post("/api/post-gamedata",{date:t.date,time:t.time,code:t.code,pressure:t.pressure})};return{getProfile:a,getPatients:n,getDoctor:r,doctorPostMessage:s,patientPostMessage:o,toggleMessage:i,numUnreadMessages:l,getMessages:c,postReply:d,getReplys:u,getExercise:g,getSingleExercise:p,postExercise:m,getEvents:h,getEventByPatientId:v,postEvent:y,getPatientEvents:f,getGameData:b,getGameDataForPatient:x,getGameDataById:D,postGameData:P,querySingleDate:$,queryDateRange:w,queryMonth:A,generateGameData:C}}angular.module("mainApp").service("dataService",e),e.$inject=["$http","authentication"]}(),function(){function e(e,t){var a=this;a.isLoggedIn=t.isLoggedIn(),a.currentUser=t.currentUser(),a.signOut=function(){t.logout()}}angular.module("mainApp").controller("navigationCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("mainApp").directive("navigation",e)}();