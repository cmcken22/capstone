function menuInit(){$("#menu-toggle").click(function(e){e.preventDefault(),$("#wrapper").toggleClass("toggled")})}function setDate(e){var t=e.year,a=e.month-1,r=e.day,n=new Date(Date.UTC(t,a,r,0,0,0)),o=n.toISOString();return o}!function(){function e(e,t){"serviceWorker"in navigator&&window.addEventListener("load",function(){navigator.serviceWorker.register("/sw.js").then(function(e){console.log("ServiceWorker registration successful with scope: ",e.scope)}).catch(function(e){console.log("ServiceWorker registration failed: ",e)})}),e.when("/dashboard",{templateUrl:"patient/dashboard/dashboard.view.html",controller:"homeCtrl",controllerAs:"vm"}).when("/patient",{redirectTo:"/dashboard"}).when("/messages",{templateUrl:"patient/messages/messages.view.html",controller:"messagesCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/calendar",{templateUrl:"patient/calendar/calendar.view.html",controller:"calendarCtrl",controllerAs:"vm"}).when("/exercises",{templateUrl:"patient/exercises/exercises.view.html",controller:"exercisesCtrl",controllerAs:"vm",reloadOnSearch:!1}).when("/profile",{templateUrl:"patient/profile/profile.view.html",controller:"profileCtrl",controllerAs:"vm"}).otherwise({redirectTo:"/dashboard"}),t.html5Mode(!0)}function t(e,t,a,r){r.defaults.headers.common.Authorization="Bearer "+a.getToken(),e.$on("$routeChangeStart",function(e,t,r){a.isLoggedIn()||(window.location="/login")})}angular.module("mainApp",["ngRoute"]),angular.module("mainApp").config(["$routeProvider","$locationProvider",e]).run(["$rootScope","$location","authentication","$http",t])}(),function(){function e(e,t,a){$("#calendar").fullCalendar({header:{left:"prev,next today",center:"title",right:"month,basicWeek,basicDay"},defaultDate:"2017-02-12",navLinks:!0,editable:!0,eventLimit:!0,events:[{title:"All Day Event",start:"2017-02-01"},{title:"Long Event",start:"2017-02-07",end:"2017-02-10"},{id:999,title:"Repeating Event",start:"2017-02-09T16:00:00"},{id:999,title:"Repeating Event",start:"2017-02-16T16:00:00"},{title:"Conference",start:"2017-02-11",end:"2017-02-13"},{title:"Meeting",start:"2017-02-12T10:30:00",end:"2017-02-12T12:30:00"},{title:"Lunch",start:"2017-02-12T12:00:00"},{title:"Meeting",start:"2017-02-12T14:30:00"},{title:"Happy Hour",start:"2017-02-12T17:30:00"},{title:"Dinner",start:"2017-02-12T20:00:00"},{title:"Birthday Party",start:"2017-02-13T07:00:00"},{title:"Click for Google",url:"http://google.com/",start:"2017-02-28"}]})}angular.module("mainApp").controller("calendarCtrl",e),e.$inject=["$compile","$location","dataService"]}(),function(){function e(e,t,a){function r(e,t){return new Date(t.date).getTime()-new Date(e.date).getTime()}menuInit(),e.myEvents=[],e.today=new Date,e.allex=[],e.mssg=[],e.myGameData=[],e.doctorName,e.thisUserId=t.currentUser()._id,e.getTime=function(e){var t=new Date(e),a=t.getMinutes();return 0==a&&(a="00"),t.getHours()+":"+a},e.getExercise=function(){a.getExercise().success(function(t){e.allex=t,console.log(e.allex),e.myEvents.forEach(function(t){e.allex.forEach(function(e){t.exercise==e._id&&(t.exercise=e)})})})},e.getData=function(){a.getEventByPatientId(e.thisUserId).success(function(t){console.log(t),t.forEach(function(t){compareDate=new Date(t.date),e.today.toDateString()==compareDate.toDateString()&&(e.myEvents.push(t),console.log(t._id),e.allex.push(t.exercise))}),e.getExercise(),e.getMessages(),e.getGameData(),a.getDoctor().success(function(t){e.doctorName=t.name}),console.log(e.myEvents)})},e.getGameData=function(){a.getGameDataForPatient(t.currentUser()._id).then(function(t){console.log(e.myGameData),t.data.sort(r);for(var a=0;a<10;a++)e.myGameData[a]=t.data[a],e.myGameData[a].date=new Date(t.data[a].date);e.myGameData.forEach(function(t){e.allex.forEach(function(e){t.exercise==e._id&&(t.exercise=e)})})})},e.getMessages=function(){a.getMessages().then(function(t){e.mssg=t.data,console.log(e.mssg)})}}angular.module("mainApp").controller("homeCtrl",e),e.$inject=["$scope","authentication","dataService"]}(),function(){function e(e,t,a){var r=this;r.allExercises=[],r.allPatients=[],r.graphDisplayed=!1,r.zoom=!1,r.options={mainGraph:"",modalGraph:""},r.options.modalGraph={scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Pressure Values"}}],xAxes:[{scaleLabel:{display:!0,labelString:"Time (Seconds)"}}]}},r.options.mainGraph={scales:{yAxes:[{scaleLabel:{display:!0,labelString:"Average Pressure Values"}}],xAxes:[{scaleLabel:{display:!0,labelString:"gameData Objects"}}]}},r.form={date:"",month:"02/2017",exercise:"ALL",patient:a.currentUser()._id,startDate:"02-05-2017",endDate:"02-07-2017"},r.dummyData={date:"02-05-2017",time:7,exercise:"100"},r.modal={title:"",details:"",gameObject:"",exercise:"",duration:""},r.graphData={storedObjects:[],datasets:[],labels:[],type:"line",datasetIndex:0,index:0};var n=Chart.helpers.color;r.colors=[],r.colors[0]={light:n(window.chartColors.red).alpha(.3).rgbString(),dark:window.chartColors.red},r.colors[1]={light:n(window.chartColors.blue).alpha(.3).rgbString(),dark:window.chartColors.blue},r.colors[2]={light:n(window.chartColors.green).alpha(.3).rgbString(),dark:window.chartColors.green},r.colors[3]={light:n(window.chartColors.purple).alpha(.3).rgbString(),dark:window.chartColors.purple},r.colors[4]={light:n(window.chartColors.orange).alpha(.3).rgbString(),dark:window.chartColors.orange},$("#graphArea").hide(),r.initInputFields=function(){r.exerciseNames=[],e.getExercise().success(function(e){r.allExercises=e,r.exerciseNames=e.map(function(e){return{id:e._id,text:e.name}}),$("#exercise-select").select2({data:r.exerciseNames,placeholder:"Select an Exercise"}),$("#exercise-select-range").select2({data:r.exerciseNames,placeholder:"Select an Exercise"})}),$("#exercise-select").on("change",function(){r.form.exercise=$("#exercise-select").val()}),$("#exercise-select-range").on("change",function(){r.form.exercise=$("#exercise-select").val()})},r.initDatePickers=function(){$("#monthPicker").datepicker({format:"mm/yyyy",viewMode:"months",minViewMode:"months",orientation:"bottom",autoclose:!0}).on("changeDate",function(){r.form.month=$("#_monthPicker").val()}),$("#monthPicker").datepicker("update",r.form.month),$("#dummyDatePicker").datepicker({format:"mm-dd-yyyy",orientation:"bottom",autoclose:!0}).on("changeDate",function(){r.dummyData.date=$("#dummyDatePickerVal").val()}),$("#dummyDatePicker").datepicker("update",r.dummyData.date),$(".input-daterange").datepicker({format:"mm-dd-yyyy",orientation:"bottom",autoclose:!0}).on("changeDate",function(){r.form.startDate=$("#_startDate").val(),r.form.endDate=$("#_endDate").val()}),$("#_startDate").datepicker("update",r.form.startDate),$("#_endDate").datepicker("update",r.form.endDate)},r.initInputFields(),r.initDatePickers(),r.generateGameData=function(){console.log("generating random data")},r.viewALLByRange=function(){r.clearObjects();for(var e=[],t=0;t<r.allExercises.length;t++)"ALL"!=r.allExercises[t].name&&(e[t]=r.allExercises[t]);var a=(e.length,new Date(r.form.startDate)),n=new Date(r.form.endDate);r.modal.title=a.toDateString()+" - "+n.toDateString(),$("#graphArea").slideDown(),r.createQuery(a,n,e)},r.viewALLByMonth=function(){r.clearObjects();for(var e=[],t=0;t<r.allExercises.length;t++)"ALL"!=r.allExercises[t].name&&(e[t]=r.allExercises[t]);var a=r.form.month.split("/"),n=a[0]+"-01-"+a[1];n=new Date(n);var o=n.getUTCMonth()+2+"-01-"+a[1];o=new Date(o),o.setDate(o.getDate()-1),r.modal.title=r.setMonthString(n.getUTCMonth()+1),$("#graphArea").slideDown(),r.createQuery(n,o,e)},r.createQuery=function(t,a,n){var o=n.length;void 0!=r.form.exercise&&"ALL"!=r.form.exercise?e.queryDateRange(t,a,r.form.patient,r.form.exercise).success(function(e){0!=e.length&&(e=r.sortByDate(e),r.graphData.storedObjects[0]=e,r.graphData.datasets[0]=r.graphAVG(e,0,r.form.exercise.name)),r.updateMainGraph()}):void 0!=r.form.exercise&&"ALL"!=r.form.exercise||r.searchDatabase(t,a,r.form.patient,n,0,o)},r.searchDatabase=function(t,a,n,o,s,i){var l=o[s]._id;e.queryDateRange(t,a,n,l).success(function(e){e=r.sortByDate(e),0!=e.length&&(r.graphData.storedObjects[s]=e,r.graphData.datasets[s]=r.graphAVG(e,s,o[s].name)),s++,s!=i?r.searchDatabase(t,a,n,o,s,i):s==i&&r.updateMainGraph()})},r.clearObjects=function(){r.graphData.storedObjects=[],r.graphData.datasets=[],r.graphData.labels=[],r.datasetIndex=0,r.index=0},r.graphAVG=function(e,t,a){for(var n=[],o=[],s=0;s<e.length;s++){o[s]=s;for(var i=0,l=0;l<e[s].pressure.length;l++)i+=e[s].pressure[l];n[s]=i/e[s].pressure.length}var c={label:a,backgroundColor:r.colors[t%r.colors.length].light,borderColor:r.colors[t%r.colors.length].dark,borderWidth:1,data:n};return r.graphData.labels[t]=o,c},r.graphPressure=function(e,t,a){console.log("Graphing Pressure:"),console.log(a);for(var n=[],o=[],s=0;s<e.pressure.length;s++)console.log(e.pressure[s]),o[s]=s,n[s]=e.pressure[s];var i={label:a,backgroundColor:r.colors[t%r.colors.length].light,borderColor:r.colors[t%r.colors.length].dark,borderWidth:1,data:n};return r.graphData.labels=o,i},r.updateMainGraph=function(){console.log("---------Updating Chart Data---------");Chart.helpers.color;r.graphDisplayed=!0;var e=r.resetCanvas();console.log("vm.graphData.datasets"),console.log(r.graphData.datasets);for(var a=-1,n=[],o=0;o<r.graphData.labels.length;o++)r.graphData.labels[o].length>a&&(n=r.graphData.labels[o]);var s={type:r.graphData.type,data:{labels:n,datasets:r.graphData.datasets},options:r.options.mainGraph},i=new Chart(document.getElementById("my-graph").getContext("2d"),s);e.remove(),console.log("graph created"),document.getElementById("my-graph").onclick=function(e){var a=i.getElementAtEvent(e),n=a[0];if(void 0!==n){r.zoom=!0,r.graphData.datasetIndex=n._datasetIndex,r.graphData.index=n._index;var o=r.graphData.storedObjects[n._datasetIndex][n._index],s=new Date(o.date);s.setMinutes(s.getTimezoneOffset()),r.modal.details=s.toDateString(),r.modal.gameObject=o,$("#myModal").modal("show"),r.displayObject(o,r.graphData.datasetIndex),t.$apply()}}},r.resetCanvas=function(){var e=$(".chartjs-hidden-iframe");e.remove();var t=$("#my-graph");return t.removeAttr("id"),$("#graph").append('<canvas id="my-graph">'),t},r.updateModalGraph=function(){console.log("Updating Chart Data");Chart.helpers.color;r.graphDisplayed=!0;var e=r.resetModalCanvas();console.log("vm.graphData.datasets"),console.log(r.graphData.datasets);var t={type:r.graphData.type,data:{labels:r.graphData.labels,datasets:r.graphData.datasets},options:r.options.modalGraph};new Chart(document.getElementById("my-modalGraph").getContext("2d"),t);e.remove()},r.resetModalCanvas=function(){var e=$("#modalGraph > .chartjs-hidden-iframe");e.remove();var t=$("#my-modalGraph");return t.removeAttr("id"),$("#modalGraph").append('<canvas id="my-modalGraph">'),t},r.displayObject=function(t,a){console.log("Displaying Object:"),console.log(a),console.log(t),console.log(t.exercise),e.getSingleExercise(t.exercise).success(function(e){r.graphData.datasets=[],r.graphData.datasets[0]=r.graphPressure(t,a,e[0].name),r.modal.exercise=e[0].name,r.updateModalGraph()})},r.next=function(){console.log("Next>>>>>>>>>>>>>>>>>>>>>>>>>>");try{r.graphData.index++,console.log(r.graphData.index);var e=r.graphData.datasetIndex;console.log(e);var t=r.graphData.storedObjects[r.graphData.datasetIndex][r.graphData.index];console.log(t);var a=new Date(t.date);a.setMinutes(a.getTimezoneOffset()),console.log(a),r.modal.details=a.toDateString(),r.modal.gameObject=t,r.displayObject(t,e)}catch(e){console.log("error: "+e),r.graphData.index--}},r.prev=function(){console.log("Prev<<<<<<<<<<<<<<<<<<<<<<<<<<");try{r.graphData.index--,console.log(r.graphData.index);var e=r.graphData.datasetIndex;console.log(e);var t=r.graphData.storedObjects[r.graphData.datasetIndex][r.graphData.index];console.log(t);var a=new Date(t.date);a.setMinutes(a.getTimezoneOffset()),console.log(a),r.modal.details=a.toDateString(),r.modal.gameObject=t,r.displayObject(t,e)}catch(e){console.log("error: "+e),r.graphData.index++}},r.setMonthString=function(e){var t;return 1==e?t="Janurary":2==e?t="February":3==e?t="March":4==e?t="April":5==e?t="May":6==e?t="June":7==e?t="July":8==e?t="August":9==e?t="September":10==e?t="October":11==e?t="November":12==e&&(t="December"),t},r.changeGraphType=function(e,t){console.log("Type: "+e),r.graphData.type=e,"main"==t?r.updateMainGraph():"modal"==t&&r.updateModalGraph()},r.sortByDate=function(e){for(var t=0;t<e.length-1;t++){for(var a=t,r=t+1;r<e.length;r++)e[r].date<e[a].date&&(a=r);var n=e[t];e[t]=e[a],e[a]=n}return e},r.sortByExercise=function(e){for(var t=0;t<e.length-1;t++){for(var a=t,r=t+1;r<e.length;r++)e[r].code<e[a].code&&(a=r);var n=e[t];e[t]=e[a],e[a]=n}return e}}angular.module("mainApp").controller("exercisesCtrl",e),e.$inject=["dataService","$scope","authentication"]}(),function(){function e(e,t,a){var r=this;r.currentUser=a.currentUser(),r.messages,r.receivedCount,r.sentCount,r.unreadCount,r.initUnreadCount,r.everythingLoaded=!1,r.doctorName,r.compose={messageSubject:"",messageBody:""},r.replyBody="",t.getDoctor().success(function(e){r.doctorName=e.name}),r.getMessages=function(){t.getMessages().success(function(e){r.messages=e,r.messageCount=e.length,r.everythingLoaded=!0,r.parseMessageData()})},r.activeReply,r.replyClick=function(e){r.activeReply=e,t.getReplys(e._id).success(function(e){r.activeReply.replysData=e})},r.postReply=function(){var e={body:r.replyBody,message:r.activeReply._id};t.postReply(e).success(function(e){r.replyBody="",r.replyClick(r.activeReply),jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your reply has successfully been sent.</div>')}).error(function(){jQuery("#reply-modal .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your reply.</div>')})},r.replySenderName=function(e){return e==r.currentUser._id?r.currentUser.name:r.doctorName},r.messageSend=function(){var e={messageSubject:r.compose.messageSubject,messageBody:r.compose.messageBody};t.patientPostMessage(e).success(function(e){r.compose.messageSubject="",r.compose.messageBody="",r.sentCount++,jQuery("#compose .alert-div").html('<div class="alert alert-dismissible alert-success"><button type="button" class="close" data-dismiss="alert">&times;</button>Your message has successfully been sent.</div>')}).error(function(){jQuery("#compse .alert-div").html('<div class="alert alert-dismissible alert-danger"><button type="button" class="close" data-dismiss="alert">&times;</button>There was an error sending your message.</div>')})},r.readMessage=function(a){a.read||a.sender==r.currentUser._id||$("#rec-"+a._id+" .panel-heading").hasClass("message-unread")&&($("#rec-"+a._id+" .panel-heading").removeClass("message-unread"),$("#unread-"+a._id+" .panel-heading").removeClass("message-unread"),t.toggleMessage(a._id).success(function(){e.$emit("messageRead"),r.unreadCount--})),a.replys&&a.replys.length>0&&t.getReplys(a._id).success(function(e){a.replysData=e})},r.markUnread=function(a){t.toggleMessage(a._id).success(function(){r.unreadCount++,e.$emit("messageUnread"),a.read=!1,$("#rec-"+a._id+" .panel-heading").addClass("message-unread"),$("#unread-"+a._id+" .panel-heading").addClass("message-unread")})},r.isMessageRead=function(e){return e?"message-read":"message-unread"},r.parseMessageData=function(){var e=0,t=0,a=0;r.messages.forEach(function(n){n.sender==r.currentUser._id&&a++,n.receiver==r.currentUser._id&&(t++,0==n.read&&e++)}),r.sentCount=a,r.receivedCount=t,r.unreadCount=e,r.initUnreadCount=e},r.dateString=function(e){var e=new Date(e);return e.toDateString()+", "+e.toLocaleTimeString()},r.getMessages()}angular.module("mainApp").controller("messagesCtrl",e),e.$inject=["$scope","dataService","authentication"]}(),function(){function e(e,t){var a=this;a.user={},t.getProfile().success(function(e){a.user=e}).error(function(e){console.log(e)})}angular.module("mainApp").controller("profileCtrl",e),e.$inject=["$location","dataService"]}(),function(){function e(e,t,a,r,n){var o=this;o.signOut=function(){r.logout()},o.loaded=!1,o.numNewMessages,o.getNumUnread=function(){n.numUnreadMessages().success(function(e){o.numNewMessages=e.count,o.loaded=!0,o.numNewMessages>0&&$("#sidebar-messages").addClass("show-circle")})},e.$on("messageRead",function(){o.numNewMessages--,o.numNewMessages<=0&&(o.numNewMessages=0,$("#sidebar-messages").removeClass("show-circle"))}),e.$on("messageUnread",function(){o.numNewMessages++,$("#sidebar-messages").hasClass("show-circle")||$("#sidebar-messages").addClass("show-circle")}),o.sidebarInit=function(e){$("#menu-toggle").click(function(e){e.preventDefault(),$("#main-wrapper").toggleClass("toggled")}),$("sidebar ul.sidebar-nav li").each(function(){$(this).find("a").attr("href").match(e)?$(this).addClass("active"):$(this).removeClass("active")})},o.getNumUnread(),o.sidebarInit(a.path())}angular.module("mainApp").controller("sidebarCtrl",e),e.$inject=["$scope","$rootScope","$location","authentication","dataService"]}(),function(){function e(){return{templateUrl:"patient/common/directives/sidebar/sidebar.template.html",controller:"sidebarCtrl as sidevm"}}angular.module("mainApp").directive("sidebar",e)}(),function(){function e(e,t){var a=function(e){t.localStorage["auth-token"]=e},r=function(){return t.localStorage["auth-token"]},n=function(){var e,a=r();return!!a&&(e=a.split(".")[1],e=t.atob(e),e=JSON.parse(e),e.exp>Date.now()/1e3)},o=function(){if(n()){var e=r(),a=e.split(".")[1];return a=t.atob(a),a=JSON.parse(a),console.log(a),{_id:a._id,email:a.email,name:a.name,role:a.role}}return!1},s=function(){return o().role},i=function(t){return e.post("/api/register",t).success(function(e){a(e.token)})},l=function(t){return e.post("/api/register-patient",t)},c=function(t){return e.post("/api/login",t).success(function(e){a(e.token)}).error(function(e){console.log(e)})},d=function(){t.localStorage.removeItem("auth-token"),t.location.reload()};return{currentUser:o,currentUserRole:s,saveToken:a,getToken:r,isLoggedIn:n,register:i,registerPatient:l,login:c,logout:d}}angular.module("mainApp").factory("authentication",e),e.$inject=["$http","$window"]}(),function(){function e(e,t){var a=function(){return e.get("/api/profile")},r=function(){return console.log("getPatients Service"),e.get("/api/get-patients")},n=function(){return e.get("/api/get-doctor")},o=function(t){return e.post("/api/doctor-post-message",t)},s=function(t){return e.post("/api/patient-post-message",t)},i=function(t){return e.post("/api/toggle-message",{message:t})},l=function(){return e.get("/api/num-unread-messages")},c=function(){return console.log("getting messages"),e.get("/api/get-messages")},d=function(t){return e.post("/api/post-reply",t)},g=function(t){return e.get("/api/get-replys/"+t)},u=function(){return e.get("/api/get-exercises")},p=function(t){return console.log("Sending to server:"),console.log(t),e.post("/api/get-single-exercise",{exercise:t})},m=function(t){return e.post("/api/post-exercise",t)},h=function(){return e.get("/api/get-event")},f=function(){return e.get("/api/get-patientevent")},v=function(t){return console.log("dataservice: "+t),e.post("/api/get-eventByPatientId",{_id:t})},y=function(t){return e.post("/api/post-event",t)},D=function(){return e.get("/api/get-gamedata")},b=function(t){return e.post("/api/get-gamedata-by-id",{_id:t})},x=function(t){return e.post("/api/getGameDataForPatient",{patient:t})},w=function(){return console.log("getting"),e.post("/api/generate-gamedata")},$=function(t){return e.post("/api/query-gamedata-single",{date:t})},C=function(t,a,r,n){return e.post("/api/query-gamedata-range",{startDate:t,endDate:a,patient:r,exercise:n})},S=function(t,a){return e.post("/api/query-gamedata-month",{startDate:t,endDate:a})},M=function(t){return e.post("/api/post-gamedata",{date:t.date,time:t.time,code:t.code,pressure:t.pressure})};return{getProfile:a,getPatients:r,getDoctor:n,doctorPostMessage:o,patientPostMessage:s,toggleMessage:i,numUnreadMessages:l,getMessages:c,postReply:d,getReplys:g,getExercise:u,getSingleExercise:p,postExercise:m,getEvents:h,getEventByPatientId:v,postEvent:y,getPatientEvents:f,getGameData:D,getGameDataForPatient:x,getGameDataById:b,postGameData:M,querySingleDate:$,queryDateRange:C,queryMonth:S,generateGameData:w}}angular.module("mainApp").service("dataService",e),e.$inject=["$http","authentication"]}(),function(){function e(e,t){var a=this;a.isLoggedIn=t.isLoggedIn(),a.currentUser=t.currentUser(),a.signOut=function(){t.logout()}}angular.module("mainApp").controller("navigationCtrl",e),e.$inject=["$location","authentication"]}(),function(){function e(){return{restrict:"EA",templateUrl:"/common/directives/navigation/navigation.template.html",controller:"navigationCtrl as navvm"}}angular.module("mainApp").directive("navigation",e)}();